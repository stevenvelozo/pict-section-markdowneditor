"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _createForOfIteratorHelper(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _superPropGet(t,e,i,n){var o=_get(_getPrototypeOf(1&n?t.prototype:t),e,i);return 2&n&&"function"==typeof o?function(t){return o.apply(i,t)}:o}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},_get.apply(null,arguments)}function _superPropBase(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _callSuper(t,e,i){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,i||[],_getPrototypeOf(t).constructor):e.apply(t,i))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MarkdownEditorExample=t()}}(function(){return function t(e,i,n){function o(r,s){if(!i[r]){if(!e[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){return o(e[r][1][t]||t)},d,d.exports,t,e,i,n)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e,i){var n=t("pict-application"),o=function(t){function e(t,i,n){return _classCallCheck(this,e),_callSuper(this,e,[t,i,n])}return _inherits(e,t),_createClass(e)}(t("../../source/Pict-Section-MarkdownEditor.js")),a={ViewIdentifier:"ExampleMarkdownEditor",TargetElementAddress:"#MarkdownEditorContainer",ContentDataAddress:"AppData.Document.Segments",ReadOnly:!1},r=function(t){function e(t,i,n){var r;return _classCallCheck(this,e),(r=_callSuper(this,e,[t,i,n])).pict.addView("ExampleMarkdownEditorView",a,o),r}return _inherits(e,t),_createClass(e,[{key:"onAfterInitialize",value:function(){_superPropGet(e,"onAfterInitialize",this,3)([]);var t=this.pict.views.ExampleMarkdownEditorView;t&&t.render()}}])}(n);e.exports=r,e.exports.default_configuration={Name:"Markdown Editor Example",Hash:"MarkdownEditorExample",MainViewportViewIdentifier:"ExampleMarkdownEditorView",pict_configuration:{Product:"MarkdownEditor-Example",DefaultAppData:{Document:{Segments:[{Content:"# Welcome to the Markdown Editor\n\nThis is the first segment. Start typing here."},{Content:"## Second Section\n\nThis is a second segment. You can add, remove, and reorder segments."},{Content:"## Diagrams & Math\n\n```mermaid\ngraph LR;\n    A[Editor] --\x3e B[Preview];\n    B --\x3e C[Rendered];\n```\n\nEinstein's equation: $E=mc^2$\n\nDisplay math:\n\n$$\n\\int_0^\\infty e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}\n$$"},{Content:"## Code Highlighting\n\nSyntax highlighting is powered by **pict-section-code** via the rich preview:\n\n```javascript\nconst greeting = 'Hello, World!';\n\nfunction fibonacci(n) {\n    if (n <= 1) return n;\n    return fibonacci(n - 1) + fibonacci(n - 2);\n}\n\nconsole.log(fibonacci(10));\n```\n\nInline code like `const x = 42` also works."}]}}}}},{"../../source/Pict-Section-MarkdownEditor.js":19,"pict-application":5}],2:[function(t,e,i){e.exports={name:"fable-serviceproviderbase",version:"3.0.18",description:"Simple base classes for fable services.",main:"source/Fable-ServiceProviderBase.js",scripts:{start:"node source/Fable-ServiceProviderBase.js",test:"npx mocha -u tdd -R spec",tests:"npx mocha -u tdd --exit -R spec --grep",coverage:"npx nyc --reporter=lcov --reporter=text-lcov npx mocha -- -u tdd -R spec",build:"npx quack build",types:"tsc -p ./tsconfig.build.json",check:"tsc -p . --noEmit"},types:"types/source/Fable-ServiceProviderBase.d.ts",mocha:{diff:!0,extension:["js"],package:"./package.json",reporter:"spec",slow:"75",timeout:"5000",ui:"tdd","watch-files":["source/**/*.js","test/**/*.js"],"watch-ignore":["lib/vendor"]},repository:{type:"git",url:"https://github.com/stevenvelozo/fable-serviceproviderbase.git"},keywords:["entity","behavior"],author:"Steven Velozo <steven@velozo.com> (http://velozo.com/)",license:"MIT",bugs:{url:"https://github.com/stevenvelozo/fable-serviceproviderbase/issues"},homepage:"https://github.com/stevenvelozo/fable-serviceproviderbase",devDependencies:{"@types/mocha":"^10.0.10",fable:"^3.1.55",quackage:"^1.0.51",typescript:"^5.9.3"}}},{}],3:[function(t,e,i){var n=t("../package.json"),o=function(){return _createClass(function t(e,i,o){_classCallCheck(this,t),this.fable,this.UUID,this.options,this.services,this.servicesMap,"object"===_typeof(e)&&e.isFable?this.connectFable(e):this.fable=!1,this._PackageFableServiceProvider=n,this.fable?(this.UUID=e.getUUID(),this.options="object"===_typeof(i)?i:{}):(this.options="object"!==_typeof(e)||e.isFable?"object"===_typeof(i)?i:{}:e,this.UUID="CORE-SVC-".concat(Math.floor(89999*Math.random()+1e4))),this.serviceType="Unknown-".concat(this.UUID),this.Hash="string"==typeof o?o:this.fable||"string"!=typeof i?"".concat(this.UUID):i},[{key:"connectFable",value:function(t){if("object"!==_typeof(t)||!t.isFable){var e="Fable Service Provider Base: Cannot connect to Fable, invalid Fable object passed in.  The pFable parameter was a [".concat(_typeof(t),"].}");return console.log(e),new Error(e)}return this.fable||(this.fable=t),this.log||(this.log=this.fable.Logging),this.services||(this.services=this.fable.services),this.servicesMap||(this.servicesMap=this.fable.servicesMap),!0}}])}();_defineProperty(o,"isFableService",!0),e.exports=o,e.exports.CoreServiceProviderBase=o},{"../package.json":2}],4:[function(t,e,i){e.exports={name:"pict-application",version:"1.0.32",description:"Application base class for a pict view-based application",main:"source/Pict-Application.js",scripts:{test:"npx mocha -u tdd -R spec",start:"node source/Pict-Application.js",coverage:"npx nyc --reporter=lcov --reporter=text-lcov npx mocha -- -u tdd -R spec",build:"npx quack build","docker-dev-build":"docker build ./ -f Dockerfile_LUXURYCode -t pict-application-image:local","docker-dev-run":'docker run -it -d --name pict-application-dev -p 30001:8080 -p 38086:8086 -v "$PWD/.config:/home/coder/.config"  -v "$PWD:/home/coder/pict-application" -u "$(id -u):$(id -g)" -e "DOCKER_USER=$USER" pict-application-image:local',"docker-dev-shell":"docker exec -it pict-application-dev /bin/bash",tests:"npx mocha -u tdd --exit -R spec --grep",lint:"eslint source/**",types:"tsc -p ."},types:"types/source/Pict-Application.d.ts",repository:{type:"git",url:"git+https://github.com/stevenvelozo/pict-application.git"},author:"steven velozo <steven@velozo.com>",license:"MIT",bugs:{url:"https://github.com/stevenvelozo/pict-application/issues"},homepage:"https://github.com/stevenvelozo/pict-application#readme",devDependencies:{"@eslint/js":"^9.28.0","browser-env":"^3.3.0",eslint:"^9.28.0",pict:"^1.0.348","pict-provider":"^1.0.10","pict-view":"^1.0.66",quackage:"^1.0.51",typescript:"^5.9.3"},mocha:{diff:!0,extension:["js"],package:"./package.json",reporter:"spec",slow:"75",timeout:"5000",ui:"tdd","watch-files":["source/**/*.js","test/**/*.js"],"watch-ignore":["lib/vendor"]},dependencies:{"fable-serviceproviderbase":"^3.0.18"}}},{}],5:[function(t,e,i){var n=t("fable-serviceproviderbase"),o=t("../package.json"),a={Name:"DefaultPictApplication",MainViewportViewIdentifier:"Default-View",MainViewportRenderableHash:!1,MainViewportDestinationAddress:!1,MainViewportDefaultDataAddress:!1,AutoSolveAfterInitialize:!0,AutoRenderMainViewportViewAfterInitialize:!0,AutoRenderViewsAfterInitialize:!1,AutoLoginAfterInitialize:!1,AutoLoadDataAfterLogin:!1,ConfigurationOnlyViews:[],Manifests:{},IdentifierAddressPrefix:"PICT-"},r=function(t){function e(t,i,n){var r;_classCallCheck(this,e);var s="object"===_typeof(t.settings.PictApplicationConfiguration)?t.settings.PictApplicationConfiguration:{};(r=_callSuper(this,e,[t,Object.assign({},JSON.parse(JSON.stringify(a)),s,i),n])).options,r.log,r.fable,r.UUID,r.Hash,r.servicesMap,r.serviceType="PictApplication",r._Package=o,r.pict=r.fable,r.AppData=r.fable.AppData,r.Bundle=r.fable.Bundle,r.initializeTimestamp,r.lastSolvedTimestamp,r.lastLoginTimestamp,r.lastMarshalFromViewsTimestamp,r.lastMarshalToViewsTimestamp,r.lastAutoRenderTimestamp,r.lastLoadDataTimestamp;var c=Object.keys(r.options.Manifests);if(c.length>0)for(var l=0;l<c.length;l++){var d=c[l];r.fable.instantiateServiceProvider("Manifest",r.options.Manifests[d],d)}return r}return _inherits(e,t),_createClass(e,[{key:"onPreSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onPreSolve:")),!0}},{key:"onPreSolveAsync",value:function(t){return this.onPreSolve(),t()}},{key:"onBeforeSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeSolve:")),!0}},{key:"onBeforeSolveAsync",value:function(t){return this.onBeforeSolve(),t()}},{key:"onSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onSolve:")),!0}},{key:"onSolveAsync",value:function(t){return this.onSolve(),t()}},{key:"solve",value:function(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing solve() function..."));for(var t=Object.keys(this.pict.providers),e=[],i=0;i<t.length;i++){var n=this.pict.providers[t[i]];n.options.AutoSolveWithApp&&e.push(n)}e.sort(function(t,e){return t.options.AutoSolveOrdinal-e.options.AutoSolveOrdinal});for(var o=0;o<e.length;o++)e[o].solve(e[o]);this.onBeforeSolve();for(var a=Object.keys(this.pict.views),r=[],s=0;s<a.length;s++){var c=this.pict.views[a[s]];c.options.AutoInitialize&&r.push(c)}r.sort(function(t,e){return t.options.AutoInitializeOrdinal-e.options.AutoInitializeOrdinal});for(var l=0;l<r.length;l++)r[l].solve();return this.onSolve(),this.onAfterSolve(),this.lastSolvedTimestamp=this.fable.log.getTimeStamp(),!0}},{key:"solveAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate");i.anticipate(this.onBeforeSolveAsync.bind(this));var n="function"==typeof t&&t;n||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," solveAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," solveAsync Auto Callback Error: ").concat(t),t)});for(var o=Object.keys(this.pict.providers),a=[],r=0;r<o.length;r++){var s=this.pict.providers[o[r]];s.options.AutoSolveWithApp&&a.push(s)}a.sort(function(t,e){return t.options.AutoSolveOrdinal-e.options.AutoSolveOrdinal});for(var c=0;c<a.length;c++)i.anticipate(a[c].solveAsync.bind(a[c]));for(var l=Object.keys(this.pict.views),d=[],p=0;p<l.length;p++){var h=this.pict.views[l[p]];h.options.AutoSolveWithApp&&d.push(h)}d.sort(function(t,e){return t.options.AutoSolveOrdinal-e.options.AutoSolveOrdinal});for(var u=0;u<d.length;u++)i.anticipate(d[u].solveAsync.bind(d[u]));i.anticipate(this.onSolveAsync.bind(this)),i.anticipate(this.onAfterSolveAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," solveAsync() complete.")),e.lastSolvedTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"onAfterSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterSolve:")),!0}},{key:"onAfterSolveAsync",value:function(t){return this.onAfterSolve(),t()}},{key:"onBeforeLoginAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeLoginAsync:")),t()}},{key:"onLoginAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onLoginAsync:")),t()}},{key:"loginAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n=t;"function"!=typeof n&&(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," loginAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," loginAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeLoginAsync.bind(this)),i.anticipate(this.onLoginAsync.bind(this)),i.anticipate(this.onAfterLoginAsync.bind(this)),this.options.AutoLoadDataAfterLogin&&i.anticipate(function(t){if(!e.isLoggedIn())return t();e.pict.LogNoisiness>1&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," auto loading data after login...")),e.loadDataAsync(function(e){t(e)})}),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," loginAsync() complete.")),e.lastLoginTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"isLoggedIn",value:function(){return!0}},{key:"onAfterLoginAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterLoginAsync:")),t()}},{key:"onBeforeLoadDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeLoadDataAsync:")),t()}},{key:"onLoadDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onLoadDataAsync:")),t()}},{key:"loadDataAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n=t;"function"!=typeof n&&(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," loadDataAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," loadDataAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeLoadDataAsync.bind(this));for(var o=Object.keys(this.pict.providers),a=[],r=0;r<o.length;r++){var s=this.pict.providers[o[r]];s.options.AutoLoadDataWithApp&&a.push(s)}a.sort(function(t,e){return t.options.AutoLoadDataOrdinal-e.options.AutoLoadDataOrdinal});for(var c=0,l=a;c<l.length;c++){var d=l[c];i.anticipate(d.onBeforeLoadDataAsync.bind(d))}i.anticipate(this.onLoadDataAsync.bind(this));for(var p=0,h=a;p<h.length;p++){var u=h[p];i.anticipate(u.onLoadDataAsync.bind(u))}i.anticipate(this.onAfterLoadDataAsync.bind(this));for(var f=0,g=a;f<g.length;f++){var m=g[f];i.anticipate(m.onAfterLoadDataAsync.bind(m))}i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," loadDataAsync() complete.")),e.lastLoadDataTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"onAfterLoadDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterLoadDataAsync:")),t()}},{key:"onBeforeSaveDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeSaveDataAsync:")),t()}},{key:"onSaveDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onSaveDataAsync:")),t()}},{key:"saveDataAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n=t;"function"!=typeof n&&(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," saveDataAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," saveDataAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeSaveDataAsync.bind(this));for(var o=Object.keys(this.pict.providers),a=[],r=0;r<o.length;r++){var s=this.pict.providers[o[r]];s.options.AutoSaveDataWithApp&&a.push(s)}a.sort(function(t,e){return t.options.AutoSaveDataOrdinal-e.options.AutoSaveDataOrdinal});for(var c=0,l=a;c<l.length;c++){var d=l[c];i.anticipate(d.onBeforeSaveDataAsync.bind(d))}i.anticipate(this.onSaveDataAsync.bind(this));for(var p=0,h=a;p<h.length;p++){var u=h[p];i.anticipate(u.onSaveDataAsync.bind(u))}i.anticipate(this.onAfterSaveDataAsync.bind(this));for(var f=0,g=a;f<g.length;f++){var m=g[f];i.anticipate(m.onAfterSaveDataAsync.bind(m))}i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," saveDataAsync() complete.")),e.lastSaveDataTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"onAfterSaveDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterSaveDataAsync:")),t()}},{key:"onBeforeInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeInitialize:")),!0}},{key:"onBeforeInitializeAsync",value:function(t){return this.onBeforeInitialize(),t()}},{key:"onInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onInitialize:")),!0}},{key:"onInitializeAsync",value:function(t){return this.onInitialize(),t()}},{key:"initialize",value:function(){if(this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initialize:")),this.initializeTimestamp)return this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initialize called but initialization is already completed.  Aborting.")),!1;if(this.onBeforeInitialize(),"ConfigurationOnlyViews"in this.options)for(var t=0;t<this.options.ConfigurationOnlyViews.length;t++){var e=void 0===this.options.ConfigurationOnlyViews[t].ViewIdentifier?"AutoView-".concat(this.fable.getUUID()):this.options.ConfigurationOnlyViews[t].ViewIdentifier;this.log.info("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," adding configuration only view: ").concat(e)),this.pict.addView(e,this.options.ConfigurationOnlyViews[t])}this.onInitialize();for(var i=Object.keys(this.pict.providers),n=[],o=0;o<i.length;o++){var a=this.pict.providers[i[o]];a.options.AutoInitialize&&n.push(a)}n.sort(function(t,e){return t.options.AutoInitializeOrdinal-e.options.AutoInitializeOrdinal});for(var r=0;r<n.length;r++)n[r].initialize();for(var s=Object.keys(this.pict.views),c=[],l=0;l<s.length;l++){var d=this.pict.views[s[l]];d.options.AutoInitialize&&c.push(d)}c.sort(function(t,e){return t.options.AutoInitializeOrdinal-e.options.AutoInitializeOrdinal});for(var p=0;p<c.length;p++)c[p].initialize();return this.onAfterInitialize(),this.options.AutoSolveAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto solving after initialization...")),this.solve()),this.options.AutoRenderMainViewportViewAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto rendering after initialization...")),this.render()),this.initializeTimestamp=this.fable.log.getTimeStamp(),this.onCompletionOfInitialize(),!0}},{key:"initializeAsync",value:function(t){var e=this;this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initializeAsync:"));var i="function"==typeof t&&t;if(i||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," initializeAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),i=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," initializeAsync Auto Callback Error: ").concat(t),t)}),this.initializeTimestamp)return this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," async initialize called but initialization is already completed.  Aborting.")),this.onCompletionOfInitializeAsync(i);var n=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate");if(this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," beginning initialization...")),"ConfigurationOnlyViews"in this.options)for(var o=0;o<this.options.ConfigurationOnlyViews.length;o++){var a=void 0===this.options.ConfigurationOnlyViews[o].ViewIdentifier?"AutoView-".concat(this.fable.getUUID()):this.options.ConfigurationOnlyViews[o].ViewIdentifier;this.log.info("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," adding configuration only view: ").concat(a)),this.pict.addView(a,this.options.ConfigurationOnlyViews[o])}n.anticipate(this.onBeforeInitializeAsync.bind(this)),n.anticipate(this.onInitializeAsync.bind(this));for(var r=Object.keys(this.pict.providers),s=[],c=0;c<r.length;c++){var l=this.pict.providers[r[c]];l.options.AutoInitialize&&s.push(l)}s.sort(function(t,e){return t.options.AutoInitializeOrdinal-e.options.AutoInitializeOrdinal});for(var d=0;d<s.length;d++)n.anticipate(s[d].initializeAsync.bind(s[d]));for(var p=Object.keys(this.pict.views),h=[],u=0;u<p.length;u++){var f=this.pict.views[p[u]];f.options.AutoInitialize&&h.push(f)}h.sort(function(t,e){return t.options.AutoInitializeOrdinal-e.options.AutoInitializeOrdinal});for(var g=0;g<h.length;g++){var m=h[g];n.anticipate(m.initializeAsync.bind(m))}n.anticipate(this.onAfterInitializeAsync.bind(this)),this.options.AutoLoginAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto login (asynchronously) after initialization...")),n.anticipate(this.loginAsync.bind(this))),this.options.AutoSolveAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto solving (asynchronously) after initialization...")),n.anticipate(this.solveAsync.bind(this))),this.options.AutoRenderMainViewportViewAfterInitialize&&(this.pict.LogNoisiness>1&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," auto rendering (asynchronously) after initialization...")),n.anticipate(this.renderMainViewportAsync.bind(this))),n.wait(function(t){return t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," initializeAsync Error: ").concat(t.message||t),{stack:t.stack}),e.initializeTimestamp=e.fable.log.getTimeStamp(),e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," initialization complete.")),i()})}},{key:"onAfterInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterInitialize:")),!0}},{key:"onAfterInitializeAsync",value:function(t){return this.onAfterInitialize(),t()}},{key:"onCompletionOfInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onCompletionOfInitialize:")),!0}},{key:"onCompletionOfInitializeAsync",value:function(t){return this.onCompletionOfInitialize(),t()}},{key:"onBeforeMarshalFromViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeMarshalFromViews:")),!0}},{key:"onBeforeMarshalFromViewsAsync",value:function(t){return this.onBeforeMarshalFromViews(),t()}},{key:"onMarshalFromViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onMarshalFromViews:")),!0}},{key:"onMarshalFromViewsAsync",value:function(t){return this.onMarshalFromViews(),t()}},{key:"marshalFromViews",value:function(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing marshalFromViews() function...")),this.onBeforeMarshalFromViews();for(var t=Object.keys(this.pict.views),e=[],i=0;i<t.length;i++){var n=this.pict.views[t[i]];e.push(n)}for(var o=0;o<e.length;o++)e[o].marshalFromView();return this.onMarshalFromViews(),this.onAfterMarshalFromViews(),this.lastMarshalFromViewsTimestamp=this.fable.log.getTimeStamp(),!0}},{key:"marshalFromViewsAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t&&t;n||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalFromViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalFromViewsAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalFromViewsAsync.bind(this));for(var o=Object.keys(this.pict.views),a=[],r=0;r<o.length;r++){var s=this.pict.views[o[r]];a.push(s)}for(var c=0;c<a.length;c++)i.anticipate(a[c].marshalFromViewAsync.bind(a[c]));i.anticipate(this.onMarshalFromViewsAsync.bind(this)),i.anticipate(this.onAfterMarshalFromViewsAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalFromViewsAsync() complete.")),e.lastMarshalFromViewsTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"onAfterMarshalFromViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterMarshalFromViews:")),!0}},{key:"onAfterMarshalFromViewsAsync",value:function(t){return this.onAfterMarshalFromViews(),t()}},{key:"onBeforeMarshalToViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeMarshalToViews:")),!0}},{key:"onBeforeMarshalToViewsAsync",value:function(t){return this.onBeforeMarshalToViews(),t()}},{key:"onMarshalToViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onMarshalToViews:")),!0}},{key:"onMarshalToViewsAsync",value:function(t){return this.onMarshalToViews(),t()}},{key:"marshalToViews",value:function(){this.pict.LogNoisiness>2&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," executing marshalToViews() function...")),this.onBeforeMarshalToViews();for(var t=Object.keys(this.pict.views),e=[],i=0;i<t.length;i++){var n=this.pict.views[t[i]];e.push(n)}for(var o=0;o<e.length;o++)e[o].marshalToView();return this.onMarshalToViews(),this.onAfterMarshalToViews(),this.lastMarshalToViewsTimestamp=this.fable.log.getTimeStamp(),!0}},{key:"marshalToViewsAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t&&t;n||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalToViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalToViewsAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalToViewsAsync.bind(this));for(var o=Object.keys(this.pict.views),a=[],r=0;r<o.length;r++){var s=this.pict.views[o[r]];a.push(s)}for(var c=0;c<a.length;c++)i.anticipate(a[c].marshalToViewAsync.bind(a[c]));i.anticipate(this.onMarshalToViewsAsync.bind(this)),i.anticipate(this.onAfterMarshalToViewsAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalToViewsAsync() complete.")),e.lastMarshalToViewsTimestamp=e.fable.log.getTimeStamp(),n(t)})}},{key:"onAfterMarshalToViews",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterMarshalToViews:")),!0}},{key:"onAfterMarshalToViewsAsync",value:function(t){return this.onAfterMarshalToViews(),t()}},{key:"onBeforeRender",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onBeforeRender:")),!0}},{key:"onBeforeRenderAsync",value:function(t){return this.onBeforeRender(),t()}},{key:"render",value:function(t,e,i,n){var o="string"!=typeof t?this.options.MainViewportViewIdentifier:t,a="string"!=typeof e?this.options.MainViewportRenderableHash:e,r="string"!=typeof i?this.options.MainViewportDestinationAddress:i,s="string"!=typeof n?this.options.MainViewportDefaultDataAddress:n;this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," VIEW Renderable[").concat(a,"] Destination[").concat(r,"] TemplateDataAddress[").concat(s,"] render:")),this.onBeforeRender();var c="string"==typeof o&&this.servicesMap.PictView[o];return c?(this.onRender(),c.render(a,r,s),this.onAfterRender(),!0):(this.log.error("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," could not render from View ").concat(o," because it is not a valid view.")),!1)}},{key:"onRender",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onRender:")),!0}},{key:"onRenderAsync",value:function(t){return this.onRender(),t()}},{key:"renderAsync",value:function(t,e,i,n,o){var a=this,r="string"!=typeof t?this.options.MainViewportViewIdentifier:t,s="string"!=typeof e?this.options.MainViewportRenderableHash:e,c="string"!=typeof i?this.options.MainViewportDestinationAddress:i,l="string"!=typeof n?this.options.MainViewportDefaultDataAddress:n,d="function"==typeof o?o:"function"==typeof n?n:"function"==typeof i?i:"function"==typeof e?e:"function"==typeof t&&t;d||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),d=function(t){t&&a.log.error("PictApp [".concat(a.UUID,"]::[").concat(a.Hash,"] ").concat(a.options.Name," renderAsync Auto Callback Error: ").concat(t),t)}),this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," VIEW Renderable[").concat(s,"] Destination[").concat(c,"] TemplateDataAddress[").concat(l,"] renderAsync:"));var p=this.fable.newAnticipate();p.anticipate(this.onBeforeRenderAsync.bind(this));var h="string"==typeof r&&this.servicesMap.PictView[r];if(!h){var u="PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," could not asynchronously render from View ").concat(r," because it is not a valid view.");return this.pict.LogNoisiness>3&&this.log.error(u),d(new Error(u))}return p.anticipate(this.onRenderAsync.bind(this)),p.anticipate(function(t){h.renderAsync.call(h,s,c,l,t)}),p.anticipate(this.onAfterRenderAsync.bind(this)),p.wait(d)}},{key:"onAfterRender",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," onAfterRender:")),!0}},{key:"onAfterRenderAsync",value:function(t){return this.onAfterRender(),t()}},{key:"renderMainViewport",value:function(){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderMainViewport:")),this.render()}},{key:"renderMainViewportAsync",value:function(t){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow APPLICATION [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderMainViewportAsync:")),this.renderAsync(t)}},{key:"renderAutoViews",value:function(){var t=this;this.pict.LogNoisiness>0&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," beginning renderAutoViews..."));var e=Object.keys(this.pict.views);e.sort(function(e,i){return t.pict.views[e].options.AutoRenderOrdinal-t.pict.views[i].options.AutoRenderOrdinal});for(var i=0;i<e.length;i++){var n=this.pict.views[e[i]];n.options.AutoRender&&n.render()}this.pict.LogNoisiness>0&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAutoViewsAsync complete."))}},{key:"renderAutoViewsAsync",value:function(t){var e=this,i=this.fable.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t&&t;n||(this.log.warn("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAutoViewsAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," renderAutoViewsAsync Auto Callback Error: ").concat(t),t)}),this.pict.LogNoisiness>0&&this.log.trace("PictApp [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," beginning renderAutoViewsAsync..."));var o=Object.keys(this.pict.views);o.sort(function(t,i){return e.pict.views[t].options.AutoRenderOrdinal-e.pict.views[i].options.AutoRenderOrdinal});for(var a=0;a<o.length;a++){var r=this.pict.views[o[a]];r.options.AutoRender&&i.anticipate(r.renderAsync.bind(r))}i.wait(function(t){return e.lastAutoRenderTimestamp=e.fable.log.getTimeStamp(),e.pict.LogNoisiness>0&&e.log.trace("PictApp [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," renderAutoViewsAsync complete.")),n(t)})}},{key:"isPictApplication",get:function(){return!0}}])}(n);e.exports=r},{"../package.json":4,"fable-serviceproviderbase":3}],6:[function(t,e,i){arguments[4][2][0].apply(i,arguments)},{dup:2}],7:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{"../package.json":6,dup:3}],8:[function(t,e,i){e.exports={name:"pict-provider",version:"1.0.10",description:"Pict Provider Base Class",main:"source/Pict-Provider.js",scripts:{start:"node source/Pict-Provider.js",test:"npx mocha -u tdd -R spec",tests:"npx mocha -u tdd --exit -R spec --grep",coverage:"npx nyc --reporter=lcov --reporter=text-lcov npx mocha -- -u tdd -R spec",build:"npx quack build","docker-dev-build":"docker build ./ -f Dockerfile_LUXURYCode -t pict-provider-image:local","docker-dev-run":'docker run -it -d --name pict-provider-dev -p 24125:8080 -p 30027:8086 -v "$PWD/.config:/home/coder/.config"  -v "$PWD:/home/coder/pict-provider" -u "$(id -u):$(id -g)" -e "DOCKER_USER=$USER" pict-provider-image:local',"docker-dev-shell":"docker exec -it pict-provider-dev /bin/bash",lint:"eslint source/**",types:"tsc -p ."},types:"types/source/Pict-Provider.d.ts",repository:{type:"git",url:"git+https://github.com/stevenvelozo/pict-provider.git"},author:"steven velozo <steven@velozo.com>",license:"MIT",bugs:{url:"https://github.com/stevenvelozo/pict-provider/issues"},homepage:"https://github.com/stevenvelozo/pict-provider#readme",devDependencies:{"@eslint/js":"^9.39.1",eslint:"^9.39.1",pict:"^1.0.348",quackage:"^1.0.51",typescript:"^5.9.3"},dependencies:{"fable-serviceproviderbase":"^3.0.18"},mocha:{diff:!0,extension:["js"],package:"./package.json",reporter:"spec",slow:"75",timeout:"5000",ui:"tdd","watch-files":["source/**/*.js","test/**/*.js"],"watch-ignore":["lib/vendor"]}}},{}],9:[function(t,e,i){var n=t("fable-serviceproviderbase"),o=t("../package.json"),a={ProviderIdentifier:!1,AutoInitialize:!0,AutoInitializeOrdinal:0,AutoLoadDataWithApp:!0,AutoSolveWithApp:!0,AutoSolveOrdinal:0,Manifests:{},Templates:[]},r=function(t){function e(t,i,n){var r;_classCallCheck(this,e),(r=_callSuper(this,e,[t,Object.assign({},JSON.parse(JSON.stringify(a)),i),n])).fable,r.pict,r.log,r.options,r.UUID,r.Hash,r.options.ProviderIdentifier||(r.options.ProviderIdentifier="AutoProviderID-".concat(r.fable.getUUID())),r.serviceType="PictProvider",r._Package=o,r.pict=r.fable,r.AppData=r.pict.AppData,r.Bundle=r.pict.Bundle,r.initializeTimestamp=!1,r.lastSolvedTimestamp=!1;for(var s=0;s<r.options.Templates.length;s++){var c=r.options.Templates[s];c.hasOwnProperty("Postfix")&&c.hasOwnProperty("Template")?(c.Source||(c.Source="PictProvider [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ProviderIdentifier," options object.")),r.pict.TemplateProvider.addDefaultTemplate(c.Prefix,c.Postfix,c.Template,c.Source)):r.log.error("PictProvider [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ProviderIdentifier," could not load Default Template ").concat(s," in the options array."),c)}return r}return _inherits(e,t),_createClass(e,[{key:"onBeforeInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onBeforeInitialize:")),!0}},{key:"onBeforeInitializeAsync",value:function(t){return this.onBeforeInitialize(),t()}},{key:"onInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onInitialize:")),!0}},{key:"onInitializeAsync",value:function(t){return this.onInitialize(),t()}},{key:"initialize",value:function(){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow PROVIDER [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," initialize:")),this.initializeTimestamp?(this.log.warn("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," initialize called but initialization is already completed.  Aborting.")),!1):(this.onBeforeInitialize(),this.onInitialize(),this.onAfterInitialize(),this.initializeTimestamp=this.pict.log.getTimeStamp(),!0)}},{key:"initializeAsync",value:function(t){var e=this;if(this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow PROVIDER [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," initializeAsync:")),this.initializeTimestamp)return this.log.warn("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," async initialize called but initialization is already completed.  Aborting.")),t();var i=this.pict.instantiateServiceProviderWithoutRegistration("Anticipate");this.pict.LogNoisiness>0&&this.log.info("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," beginning initialization...")),i.anticipate(this.onBeforeInitializeAsync.bind(this)),i.anticipate(this.onInitializeAsync.bind(this)),i.anticipate(this.onAfterInitializeAsync.bind(this)),i.wait(function(i){return e.initializeTimestamp=e.pict.log.getTimeStamp(),i?e.log.error("PictProvider [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ProviderIdentifier," initialization failed: ").concat(i.message||i),{Stack:i.stack}):e.pict.LogNoisiness>0&&e.log.info("PictProvider [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ProviderIdentifier," initialization complete.")),t()})}},{key:"onAfterInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onAfterInitialize:")),!0}},{key:"onAfterInitializeAsync",value:function(t){return this.onAfterInitialize(),t()}},{key:"onPreRender",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onPreRender:")),!0}},{key:"onPreRenderAsync",value:function(t){return this.onPreRender(),t()}},{key:"render",value:function(){return this.onPreRender()}},{key:"renderAsync",value:function(t){return this.onPreRender(),t()}},{key:"onPreSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onPreSolve:")),!0}},{key:"onPreSolveAsync",value:function(t){return this.onPreSolve(),t()}},{key:"solve",value:function(){return this.onPreSolve()}},{key:"solveAsync",value:function(t){return this.onPreSolve(),t()}},{key:"onBeforeLoadDataAsync",value:function(t){return t()}},{key:"onLoadDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onLoadDataAsync:")),t()}},{key:"onAfterLoadDataAsync",value:function(t){return t()}},{key:"onBeforeSaveDataAsync",value:function(t){return t()}},{key:"onSaveDataAsync",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictProvider [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ProviderIdentifier," onSaveDataAsync:")),t()}},{key:"onAfterSaveDataAsync",value:function(t){return t()}}])}(n);e.exports=r},{"../package.json":8,"fable-serviceproviderbase":7}],10:[function(t,e,i){var n={javascript:{tokenizer:/(\/\/[^\n]*|\/\*[\s\S]*?\*\/)|(["'])(?:(?!\2|\\).|\\.)*?\2|(`(?:[^`\\]|\\.)*?`)|(\/(?![/*])(?:\\.|\[(?:\\.|[^\]])*\]|[^/\\\n])+\/[gimsuvy]*)/g,keywords:/\b(async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|export|extends|finally|for|from|function|get|if|import|in|instanceof|let|new|of|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/g,builtins:/\b(true|false|null|undefined|NaN|Infinity|console|window|document|Math|JSON|Array|Object|String|Number|Boolean|Date|RegExp|Map|Set|Promise|Error|Symbol|parseInt|parseFloat|require|module|exports)\b/g,numbers:/\b(\d+\.?\d*(?:e[+-]?\d+)?|0x[0-9a-fA-F]+|0b[01]+|0o[0-7]+)\b/g},json:{tokenizer:/(\/\/[^\n]*|\/\*[\s\S]*?\*\/)|("(?:[^"\\]|\\.)*")/g,keywords:/\b(true|false|null)\b/g,numbers:/-?\b\d+\.?\d*(?:e[+-]?\d+)?\b/g},html:{tokenizer:/(<!--[\s\S]*?-->)|(["'])(?:(?!\2|\\).|\\.)*?\2|(<\/?[a-zA-Z][a-zA-Z0-9-]*(?:\s+[a-zA-Z-]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]*))?)*\s*\/?>)/g,tagGroupIndex:3},css:{tokenizer:/(\/\*[\s\S]*?\*\/)|(["'])(?:(?!\2|\\).|\\.)*?\2/g,selectors:/([.#]?[a-zA-Z_][\w-]*(?:\s*[>+~]\s*[.#]?[a-zA-Z_][\w-]*)*)\s*\{/g,properties:/\b([a-zA-Z-]+)\s*:/g,numbers:/\b(\d+\.?\d*)(px|em|rem|%|vh|vw|s|ms|deg|fr)?\b/g,keywords:/\b(important|inherit|initial|unset|none|auto|block|inline|flex|grid)\b/g},sql:{tokenizer:/(--[^\n]*|\/\*[\s\S]*?\*\/)|(["'])(?:(?!\2|\\).|\\.)*?\2/g,keywords:/\b(SELECT|FROM|WHERE|AND|OR|INSERT|INTO|VALUES|UPDATE|SET|DELETE|CREATE|TABLE|DROP|ALTER|ADD|COLUMN|INDEX|JOIN|LEFT|RIGHT|INNER|OUTER|ON|AS|ORDER|BY|GROUP|HAVING|LIMIT|OFFSET|UNION|ALL|DISTINCT|COUNT|SUM|AVG|MIN|MAX|NOT|NULL|IS|IN|BETWEEN|LIKE|EXISTS|CASE|WHEN|THEN|ELSE|END|PRIMARY|KEY|FOREIGN|REFERENCES|CONSTRAINT|DEFAULT|CHECK|UNIQUE|CASCADE|GRANT|REVOKE|COMMIT|ROLLBACK|BEGIN|TRANSACTION|INT|VARCHAR|DATETIME|AUTO_INCREMENT|CURRENT_TIMESTAMP)\b/gi,numbers:/\b\d+\.?\d*\b/g}};function o(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(t,e){var i=t;return e.selectors&&(e.selectors.lastIndex=0,i=i.replace(e.selectors,'<span class="function-name">$1</span>{')),e.properties&&(e.properties.lastIndex=0,i=i.replace(e.properties,'<span class="property">$1</span>:')),e.keywords&&(e.keywords.lastIndex=0,i=i.replace(e.keywords,'<span class="keyword">$1</span>')),e.builtins&&(e.builtins.lastIndex=0,i=i.replace(e.builtins,'<span class="keyword">$1</span>')),e.numbers&&(e.numbers.lastIndex=0,i=i.replace(e.numbers,function(t){return'<span class="number">'.concat(t,"</span>")})),i}function r(t){var e="",i=t,n=i.match(/^(<\/?)([a-zA-Z][a-zA-Z0-9-]*)/);if(!n)return o(t);e+=o(n[1]),e+='<span class="tag">'+o(n[2])+"</span>",i=i.substring(n[0].length);for(var a,r=/^(\s+)([a-zA-Z-]+)(?:(\s*=\s*)(["'])([^"']*?)\4)?/;null!==(a=i.match(r));)e+=a[1],e+='<span class="attr-name">'+o(a[2])+"</span>",a[3]&&(e+=o(a[3]),e+='<span class="attr-value">'+o(a[4])+o(a[5])+o(a[4])+"</span>"),i=i.substring(a[0].length);return e+=o(i)}n.js=n.javascript,n.htm=n.html,e.exports=function(t){return function(e){var i=e.textContent,s="string"==typeof t?t.toLowerCase():"javascript",c=n[s];if(c)if(c.tokenizer){var l,d="",p=0,h=c.tagGroupIndex||0;for(c.tokenizer.lastIndex=0;null!==(l=c.tokenizer.exec(i));){if(l.index>p)d+=a(o(i.substring(p,l.index)),c);var u=l[0];l[1]?d+='<span class="comment">'.concat(o(u),"</span>"):h>0&&l[h]?d+=r(u):d+='<span class="string">'.concat(o(u),"</span>"),p=c.tokenizer.lastIndex}if(p<i.length)d+=a(o(i.substring(p)),c);e.innerHTML=d}else e.innerHTML=a(o(i),c);else e.innerHTML=o(i)}},e.exports.LanguageDefinitions=n},{}],11:[function(t,e,i){e.exports={RenderOnLoad:!0,DefaultRenderable:"CodeEditor-Wrap",DefaultDestinationAddress:"#CodeEditor-Container-Div",Templates:[{Hash:"CodeEditor-Container",Template:"\x3c!-- CodeEditor-Container Rendering Soon --\x3e"}],Renderables:[{RenderableHash:"CodeEditor-Wrap",TemplateHash:"CodeEditor-Container",DestinationAddress:"#CodeEditor-Container-Div"}],TargetElementAddress:"#CodeEditor-Container-Div",CodeDataAddress:!1,Language:"javascript",ReadOnly:!1,Tab:"\t",IndentOn:/[({[]$/,MoveToNewLine:/^[)}\]]/,AddClosing:!0,CatchTab:!0,LineNumbers:!0,DefaultCode:"// Enter your code here\n",CSS:".pict-code-editor-wrap\n{\n\tposition: relative;\n\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;\n\tfont-size: 14px;\n\tline-height: 1.5;\n\tborder: 1px solid #D0D0D0;\n\tborder-radius: 4px;\n\toverflow: auto;\n}\n.pict-code-editor-wrap .pict-code-line-numbers\n{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 40px;\n\tpadding: 10px 0;\n\ttext-align: right;\n\tbackground: #F5F5F5;\n\tborder-right: 1px solid #D0D0D0;\n\tcolor: #999;\n\tfont-size: 13px;\n\tline-height: 1.5;\n\tuser-select: none;\n\tpointer-events: none;\n\tbox-sizing: border-box;\n}\n.pict-code-editor-wrap .pict-code-line-numbers span\n{\n\tdisplay: block;\n\tpadding: 0 8px 0 0;\n}\n.pict-code-editor-wrap .pict-code-editor\n{\n\tmargin: 0;\n\tpadding: 10px 10px 10px 48px;\n\tmin-height: 100px;\n\toutline: none;\n\ttab-size: 4;\n\twhite-space: pre;\n\toverflow-wrap: normal;\n\toverflow-x: auto;\n\tcolor: #383A42;\n\tbackground: #FAFAFA;\n\tcaret-color: #526FFF;\n\tborder-radius: 4px;\n}\n.pict-code-editor-wrap .pict-code-editor.pict-code-no-line-numbers\n{\n\tpadding-left: 10px;\n}\n.pict-code-editor-wrap .pict-code-editor .keyword { color: #A626A4; }\n.pict-code-editor-wrap .pict-code-editor .string { color: #50A14F; }\n.pict-code-editor-wrap .pict-code-editor .number { color: #986801; }\n.pict-code-editor-wrap .pict-code-editor .comment { color: #A0A1A7; font-style: italic; }\n.pict-code-editor-wrap .pict-code-editor .operator { color: #0184BC; }\n.pict-code-editor-wrap .pict-code-editor .punctuation { color: #383A42; }\n.pict-code-editor-wrap .pict-code-editor .function-name { color: #4078F2; }\n.pict-code-editor-wrap .pict-code-editor .property { color: #E45649; }\n.pict-code-editor-wrap .pict-code-editor .tag { color: #E45649; }\n.pict-code-editor-wrap .pict-code-editor .attr-name { color: #986801; }\n.pict-code-editor-wrap .pict-code-editor .attr-value { color: #50A14F; }\n"}},{}],12:[function(t,e,i){var n=t("pict-view"),o=t("./Pict-Code-Highlighter.js"),a=t("./Pict-Section-Code-DefaultConfiguration.js"),r=function(t){function e(t,i,n){var o;return _classCallCheck(this,e),(o=_callSuper(this,e,[t,Object.assign({},a,i),n])).initialRenderComplete=!1,o.codeJar=null,o._highlightFunction=null,o._language=o.options.Language||"javascript",o}return _inherits(e,t),_createClass(e,[{key:"onBeforeInitialize",value:function(){return _superPropGet(e,"onBeforeInitialize",this,3)([]),this._codeJarPrototype=null,this.targetElement=!1,this._highlightFunction=o(this._language),_superPropGet(e,"onBeforeInitialize",this,3)([])}},{key:"connectCodeJarPrototype",value:function(t){if("function"!=typeof t)return"undefined"!=typeof window&&"function"==typeof window.CodeJar?(this.log.trace("PICT-Code Found CodeJar in window.CodeJar."),void(this._codeJarPrototype=window.CodeJar)):(this.log.error("PICT-Code No CodeJar prototype found. Include codejar via script tag or call connectCodeJarPrototype(CodeJar) explicitly."),!1);this._codeJarPrototype=t}},{key:"onAfterRender",value:function(t){return this.pict.CSSMap.injectCSS(),this.initialRenderComplete||(this.onAfterInitialRender(),this.initialRenderComplete=!0),_superPropGet(e,"onAfterRender",this,3)([t])}},{key:"onAfterInitialRender",value:function(){var t=this;if(this._codeJarPrototype||this.connectCodeJarPrototype(),!this._codeJarPrototype)return this.log.error("PICT-Code Cannot initialize editor; no CodeJar prototype available."),!1;if(this.codeJar)return this.log.error("PICT-Code editor is already initialized!"),!1;var e=this.services.ContentAssignment.getElement(this.options.TargetElementAddress);if(!e||e.length<1)return this.log.error("PICT-Code Could not find target element [".concat(this.options.TargetElementAddress,"]!")),this.targetElement=!1,!1;this.targetElement=e[0],this._buildEditorDOM();var i=this._resolveCodeContent(),n={};this.options.Tab&&(n.tab=this.options.Tab),this.options.IndentOn&&(n.indentOn=this.options.IndentOn),this.options.MoveToNewLine&&(n.moveToNewLine=this.options.MoveToNewLine),void 0!==this.options.AddClosing&&(n.addClosing=this.options.AddClosing),void 0!==this.options.CatchTab&&(n.catchTab=this.options.CatchTab),this.customConfigureEditorOptions(n);var o=this._editorElement;this.codeJar=this._codeJarPrototype(o,this._highlightFunction,n),i&&this.codeJar.updateCode(i),this.codeJar.onUpdate(function(e){t._updateLineNumbers(),t.onCodeChange(e)}),this._updateLineNumbers(),this.options.ReadOnly&&o.setAttribute("contenteditable","false")}},{key:"_buildEditorDOM",value:function(){this.targetElement.innerHTML="";var t=document.createElement("div");if(t.className="pict-code-editor-wrap",this.options.LineNumbers){var e=document.createElement("div");e.className="pict-code-line-numbers",t.appendChild(e),this._lineNumbersElement=e}var i=document.createElement("div");i.className="pict-code-editor language-"+this._language,this.options.LineNumbers||(i.className+=" pict-code-no-line-numbers"),t.appendChild(i),this.targetElement.appendChild(t),this._editorElement=i,this._wrapElement=t}},{key:"_updateLineNumbers",value:function(){if(this.options.LineNumbers&&this._lineNumbersElement&&this._editorElement){for(var t=(this._editorElement.textContent||"").split("\n").length,e="",i=1;i<=t;i++)e+="<span>".concat(i,"</span>");this._lineNumbersElement.innerHTML=e}}},{key:"_resolveCodeContent",value:function(){if(this.options.CodeDataAddress){var t={Fable:this.fable,Pict:this.fable,AppData:this.AppData,Bundle:this.Bundle,Options:this.options},e=this.fable.manifest.getValueByHash(t,this.options.CodeDataAddress);if("string"==typeof e)return e;this.log.warn("PICT-Code Address [".concat(this.options.CodeDataAddress,"] did not return a string; it was ").concat(_typeof(e),"."))}return this.options.DefaultCode||""}},{key:"customConfigureEditorOptions",value:function(t){}},{key:"onCodeChange",value:function(t){if(this.options.CodeDataAddress){var e={Fable:this.fable,Pict:this.fable,AppData:this.AppData,Bundle:this.Bundle,Options:this.options};this.fable.manifest.setValueByHash(e,this.options.CodeDataAddress,t)}}},{key:"getCode",value:function(){return this.codeJar?this.codeJar.toString():(this.log.warn("PICT-Code getCode called before editor initialized."),"")}},{key:"setCode",value:function(t){this.codeJar?(this.codeJar.updateCode(t),this._updateLineNumbers()):this.log.warn("PICT-Code setCode called before editor initialized.")}},{key:"setLanguage",value:function(t){var e=this;if(this._language=t,this._highlightFunction=o(t),this._editorElement&&(this._editorElement.className="pict-code-editor language-"+t,this.options.LineNumbers||(this._editorElement.className+=" pict-code-no-line-numbers")),this.codeJar){var i=this.codeJar.toString();this.codeJar.destroy(),this.codeJar=this._codeJarPrototype(this._editorElement,this._highlightFunction,{tab:this.options.Tab,catchTab:this.options.CatchTab,addClosing:this.options.AddClosing}),this.codeJar.updateCode(i),this.codeJar.onUpdate(function(t){e._updateLineNumbers(),e.onCodeChange(t)})}}},{key:"setHighlightFunction",value:function(t){var e=this;if("function"==typeof t){if(this._highlightFunction=t,this.codeJar){var i=this.codeJar.toString();this.codeJar.destroy(),this.codeJar=this._codeJarPrototype(this._editorElement,this._highlightFunction,{tab:this.options.Tab,catchTab:this.options.CatchTab,addClosing:this.options.AddClosing}),this.codeJar.updateCode(i),this.codeJar.onUpdate(function(t){e._updateLineNumbers(),e.onCodeChange(t)})}}else this.log.error("PICT-Code setHighlightFunction requires a function.")}},{key:"setReadOnly",value:function(t){this.options.ReadOnly=t,this._editorElement&&this._editorElement.setAttribute("contenteditable",t?"false":"true")}},{key:"destroy",value:function(){this.codeJar&&(this.codeJar.destroy(),this.codeJar=null)}},{key:"marshalToView",value:function(){if(_superPropGet(e,"marshalToView",this,3)([]),this.codeJar&&this.options.CodeDataAddress){var t=this._resolveCodeContent();"string"==typeof t&&(this.codeJar.updateCode(t),this._updateLineNumbers())}}},{key:"marshalFromView",value:function(){_superPropGet(e,"marshalFromView",this,3)([]),this.codeJar&&this.options.CodeDataAddress&&this.onCodeChange(this.codeJar.toString())}}])}(n);e.exports=r,e.exports.default_configuration=a,e.exports.createHighlighter=o},{"./Pict-Code-Highlighter.js":10,"./Pict-Section-Code-DefaultConfiguration.js":11,"pict-view":17}],13:[function(t,e,i){e.exports=t("./views/Pict-View-Content.js"),e.exports.PictContentProvider=t("./providers/Pict-Provider-Content.js")},{"./providers/Pict-Provider-Content.js":14,"./views/Pict-View-Content.js":15}],14:[function(t,e,i){var n=t("pict-provider"),o=t("pict-section-code").createHighlighter,a=function(t){function e(t,i,n){return _classCallCheck(this,e),_callSuper(this,e,[t,i,n])}return _inherits(e,t),_createClass(e,[{key:"highlightCode",value:function(t,e){if(!t)return"";var i={textContent:t,innerHTML:""};return o(e)(i),i.innerHTML}},{key:"generateLineNumbers",value:function(t){if(!t)return"<span>1</span>";for(var e=t.split("\n").length,i="",n=1;n<=e;n++)i+="<span>"+n+"</span>";return i}},{key:"parseMarkdown",value:function(t,e){var i=this;if(!t)return"";for(var n=t.split("\n"),o=[],a=!1,r=0,s="",c=[],l=!1,d="",p=!1,h=[],u=!1,f=[],g=[],m=function(){g.length>0&&(o.push("<p>"+g.map(function(t){return i.parseInline(t,e)}).join(" ")+"</p>"),g=[])},v=0;v<n.length;v++){var y=n[v];if(a||!y.trim().match(/^\$\$/))if(u)f.push(y);else{var b=y.match(/^(`{3,})/);if(b){var w=b[1].length;if(a){if(w>=r&&y.trim()===b[1]){if("mermaid"===s)o.push('<pre class="mermaid">'+c.join("\n")+"</pre>");else{var A=c.join("\n"),I=this.highlightCode(A,s),D=this.generateLineNumbers(A);o.push('<div class="pict-content-code-wrap"><div class="pict-content-code-line-numbers">'+D+'</div><pre><code class="language-'+this.escapeHTML(s)+'">'+I+"</code></pre></div>")}a=!1,r=0,s="",c=[];continue}c.push(y);continue}m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1),p&&(o.push("<blockquote>"+this.parseMarkdown(h.join("\n"),e)+"</blockquote>"),p=!1,h=[]),r=w,s=y.replace(/^`{3,}/,"").trim(),a=!0}else if(a)c.push(y);else if(y.match(/^>\s?/))p||(m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1),p=!0,h=[]),h.push(y.replace(/^>\s?/,""));else if(p&&(o.push("<blockquote>"+this.parseMarkdown(h.join("\n"),e)+"</blockquote>"),p=!1,h=[]),y.match(/^(-{3,}|\*{3,}|_{3,})\s*$/))m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1),o.push("<hr>");else{var P=y.match(/^(#{1,6})\s+(.+)/);if(P){m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1);var k=P[1].length,C=this.parseInline(P[2],e),S=P[2].toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");o.push("<h"+k+' id="'+S+'">'+C+"</h"+k+">")}else{var _=y.match(/^(\s*)[-*+]\s+(.*)/);if(_)m(),l&&"ul"===d||(l&&o.push("ul"===d?"</ul>":"</ol>"),o.push("<ul>"),l=!0,d="ul"),o.push("<li>"+this.parseInline(_[2],e)+"</li>");else{var T=y.match(/^(\s*)\d+\.\s+(.*)/);if(T)m(),l&&"ol"===d||(l&&o.push("ul"===d?"</ul>":"</ol>"),o.push("<ol>"),l=!0,d="ol"),o.push("<li>"+this.parseInline(T[2],e)+"</li>");else if(l&&""!==y.trim()&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1),""!==y.trim())if(y.match(/^\|/)&&v+1<n.length&&n[v+1].match(/^\|[\s-:|]+\|/)){m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1);var U="<table>",V=y.split("|").filter(function(t){return""!==t.trim()});U+="<thead><tr>";for(var E=0;E<V.length;E++)U+="<th>"+this.parseInline(V[E].trim(),e)+"</th>";for(U+="</tr></thead>",v++,U+="<tbody>";v+1<n.length&&n[v+1].match(/^\|/);){var R=n[++v].split("|").filter(function(t){return""!==t.trim()});U+="<tr>";for(var x=0;x<R.length;x++)U+="<td>"+this.parseInline(R[x].trim(),e)+"</td>";U+="</tr>"}U+="</tbody></table>",o.push(U)}else g.push(y);else m()}}}}else u?(o.push('<div class="pict-content-katex-display">'+f.join("\n")+"</div>"),u=!1,f=[]):(m(),l&&(o.push("ul"===d?"</ul>":"</ol>"),l=!1),p&&(o.push("<blockquote>"+this.parseMarkdown(h.join("\n"),e)+"</blockquote>"),p=!1,h=[]),u=!0)}if(m(),l&&o.push("ul"===d?"</ul>":"</ol>"),p&&o.push("<blockquote>"+this.parseMarkdown(h.join("\n"),e)+"</blockquote>"),a){var M=c.join("\n"),H=this.highlightCode(M,s),L=this.generateLineNumbers(M);o.push('<div class="pict-content-code-wrap"><div class="pict-content-code-line-numbers">'+L+"</div><pre><code>"+H+"</code></pre></div>")}return o.join("\n")}},{key:"parseInline",value:function(t,e){if(!t)return"";var i=t,n=[];return i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i.replace(/`([^`]+)`/g,function(t,e){var i=n.length;return n.push("<code>"+e+"</code>"),"\0CODEINLINE"+i+"\0"})).replace(/\$([^\$\s][^\$]*?[^\$\s])\$/g,'<span class="pict-content-katex-inline">$1</span>')).replace(/\$([^\$\s])\$/g,'<span class="pict-content-katex-inline">$1</span>')).replace(/!\[([^\]]*)\]\(([^)]+)\)/g,'<img src="$2" alt="$1">')).replace(/\[([^\]]+)\]\(([^)]+)\)/g,function(t,i,n){if("function"==typeof e){var o=e(n,i);if(o){var a=o.target?' target="'+o.target+'"':"",r=o.rel?' rel="'+o.rel+'"':"";return'<a href="'+o.href+'"'+a+r+">"+i+"</a>"}}return n.match(/^https?:\/\//)?'<a href="'+n+'" target="_blank" rel="noopener">'+i+"</a>":'<a href="'+n+'">'+i+"</a>"})).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/__([^_]+)__/g,"<strong>$1</strong>")).replace(/\*([^*]+)\*/g,"<em>$1</em>")).replace(/_([^_]+)_/g,"<em>$1</em>")).replace(/\x00CODEINLINE(\d+)\x00/g,function(t,e){return n[parseInt(e)]})}},{key:"escapeHTML",value:function(t){return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}}])}(n);e.exports=a,e.exports.default_configuration={ProviderIdentifier:"Pict-Content",AutoInitialize:!0,AutoInitializeOrdinal:0}},{"pict-provider":9,"pict-section-code":12}],15:[function(t,e,i){var n=function(t){function e(t,i,n){return _classCallCheck(this,e),_callSuper(this,e,[t,i,n])}return _inherits(e,t),_createClass(e,[{key:"displayContent",value:function(t,e){var i=e||"Pict-Content-Body";this.pict.ContentAssignment.assignContent("#"+i,t);var n=document.getElementById(i);n&&n.parentElement&&(n.parentElement.scrollTop=0),this.renderMermaidDiagrams(i),this.renderKaTeXEquations(i)}},{key:"renderMermaidDiagrams",value:function(t){if("undefined"!=typeof mermaid){var e=t||"Pict-Content-Body",i=document.getElementById(e);if(i){var n=i.querySelectorAll("pre.mermaid");if(!(n.length<1))try{mermaid.run({nodes:n})}catch(t){this.log.error("Mermaid rendering error: "+t.message)}}}}},{key:"renderKaTeXEquations",value:function(t){if("undefined"!=typeof katex){var e=t||"Pict-Content-Body",i=document.getElementById(e);if(i){for(var n=i.querySelectorAll(".pict-content-katex-inline"),o=0;o<n.length;o++)try{katex.render(n[o].textContent,n[o],{throwOnError:!1,displayMode:!1})}catch(t){this.log.warn("KaTeX inline error: "+t.message)}for(var a=i.querySelectorAll(".pict-content-katex-display"),r=0;r<a.length;r++)try{katex.render(a[r].textContent,a[r],{throwOnError:!1,displayMode:!0})}catch(t){this.log.warn("KaTeX display error: "+t.message)}}}}},{key:"showLoading",value:function(t,e){var i=e||"Pict-Content-Body",n=t||"Loading content...";this.pict.ContentAssignment.assignContent("#"+i,'<div class="pict-content-loading">'+n+"</div>")}}])}(t("pict-view"));e.exports=n,e.exports.default_configuration={ViewIdentifier:"Pict-Content",DefaultRenderable:"Pict-Content-Display",DefaultDestinationAddress:"#Pict-Content-Container",AutoRender:!1,CSS:"\n\t\t.pict-content {\n\t\t\tpadding: 2em 3em;\n\t\t\tmax-width: 900px;\n\t\t\tmargin: 0 auto;\n\t\t}\n\t\t.pict-content-loading {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tmin-height: 200px;\n\t\t\tcolor: #8A7F72;\n\t\t\tfont-size: 1em;\n\t\t}\n\t\t.pict-content h1 {\n\t\t\tfont-size: 2em;\n\t\t\tcolor: #3D3229;\n\t\t\tborder-bottom: 1px solid #DDD6CA;\n\t\t\tpadding-bottom: 0.3em;\n\t\t\tmargin-top: 0;\n\t\t}\n\t\t.pict-content h2 {\n\t\t\tfont-size: 1.5em;\n\t\t\tcolor: #3D3229;\n\t\t\tborder-bottom: 1px solid #EAE3D8;\n\t\t\tpadding-bottom: 0.25em;\n\t\t\tmargin-top: 1.5em;\n\t\t}\n\t\t.pict-content h3 {\n\t\t\tfont-size: 1.25em;\n\t\t\tcolor: #3D3229;\n\t\t\tmargin-top: 1.25em;\n\t\t}\n\t\t.pict-content h4, .pict-content h5, .pict-content h6 {\n\t\t\tcolor: #5E5549;\n\t\t\tmargin-top: 1em;\n\t\t}\n\t\t.pict-content p {\n\t\t\tline-height: 1.7;\n\t\t\tcolor: #423D37;\n\t\t\tmargin: 0.75em 0;\n\t\t}\n\t\t.pict-content a {\n\t\t\tcolor: #2E7D74;\n\t\t\ttext-decoration: none;\n\t\t}\n\t\t.pict-content a:hover {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t\t.pict-content-code-wrap {\n\t\t\tposition: relative;\n\t\t\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;\n\t\t\tfont-size: 14px;\n\t\t\tline-height: 1.5;\n\t\t\tborder-radius: 6px;\n\t\t\toverflow: auto;\n\t\t\tmargin: 1em 0;\n\t\t\tbackground: #3D3229;\n\t\t}\n\t\t.pict-content-code-wrap .pict-content-code-line-numbers {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 40px;\n\t\t\tpadding: 1.25em 0;\n\t\t\ttext-align: right;\n\t\t\tbackground: #342A22;\n\t\t\tborder-right: 1px solid #4A3F35;\n\t\t\tcolor: #8A7F72;\n\t\t\tfont-size: 13px;\n\t\t\tline-height: 1.5;\n\t\t\tuser-select: none;\n\t\t\tpointer-events: none;\n\t\t\tbox-sizing: border-box;\n\t\t}\n\t\t.pict-content-code-wrap .pict-content-code-line-numbers span {\n\t\t\tdisplay: block;\n\t\t\tpadding: 0 8px 0 0;\n\t\t}\n\t\t.pict-content-code-wrap pre {\n\t\t\tmargin: 0;\n\t\t\tbackground: #3D3229;\n\t\t\tcolor: #E8E0D4;\n\t\t\tpadding: 1.25em 1.25em 1.25em 52px;\n\t\t\tborder-radius: 6px;\n\t\t\toverflow-x: auto;\n\t\t\tline-height: 1.5;\n\t\t\tfont-size: inherit;\n\t\t}\n\t\t.pict-content-code-wrap pre code {\n\t\t\tbackground: none;\n\t\t\tpadding: 0;\n\t\t\tcolor: inherit;\n\t\t\tfont-size: inherit;\n\t\t\tfont-family: inherit;\n\t\t}\n\t\t.pict-content-code-wrap .keyword { color: #C678DD; }\n\t\t.pict-content-code-wrap .string { color: #98C379; }\n\t\t.pict-content-code-wrap .number { color: #D19A66; }\n\t\t.pict-content-code-wrap .comment { color: #7F848E; font-style: italic; }\n\t\t.pict-content-code-wrap .operator { color: #56B6C2; }\n\t\t.pict-content-code-wrap .punctuation { color: #E8E0D4; }\n\t\t.pict-content-code-wrap .function-name { color: #61AFEF; }\n\t\t.pict-content-code-wrap .property { color: #E06C75; }\n\t\t.pict-content-code-wrap .tag { color: #E06C75; }\n\t\t.pict-content-code-wrap .attr-name { color: #D19A66; }\n\t\t.pict-content-code-wrap .attr-value { color: #98C379; }\n\t\t.pict-content pre {\n\t\t\tbackground: #3D3229;\n\t\t\tcolor: #E8E0D4;\n\t\t\tpadding: 1.25em;\n\t\t\tborder-radius: 6px;\n\t\t\toverflow-x: auto;\n\t\t\tline-height: 1.5;\n\t\t\tfont-size: 0.9em;\n\t\t}\n\t\t.pict-content code {\n\t\t\tbackground: #F0ECE4;\n\t\t\tpadding: 0.15em 0.4em;\n\t\t\tborder-radius: 3px;\n\t\t\tfont-size: 0.9em;\n\t\t\tcolor: #9E6B47;\n\t\t}\n\t\t.pict-content pre code {\n\t\t\tbackground: none;\n\t\t\tpadding: 0;\n\t\t\tcolor: inherit;\n\t\t\tfont-size: inherit;\n\t\t}\n\t\t.pict-content blockquote {\n\t\t\tborder-left: 4px solid #2E7D74;\n\t\t\tmargin: 1em 0;\n\t\t\tpadding: 0.5em 1em;\n\t\t\tbackground: #F7F5F0;\n\t\t\tcolor: #5E5549;\n\t\t}\n\t\t.pict-content blockquote p {\n\t\t\tmargin: 0.25em 0;\n\t\t}\n\t\t.pict-content ul, .pict-content ol {\n\t\t\tpadding-left: 2em;\n\t\t\tline-height: 1.8;\n\t\t}\n\t\t.pict-content li {\n\t\t\tmargin: 0.25em 0;\n\t\t\tcolor: #423D37;\n\t\t}\n\t\t.pict-content hr {\n\t\t\tborder: none;\n\t\t\tborder-top: 1px solid #DDD6CA;\n\t\t\tmargin: 2em 0;\n\t\t}\n\t\t.pict-content table {\n\t\t\twidth: 100%;\n\t\t\tborder-collapse: collapse;\n\t\t\tmargin: 1em 0;\n\t\t}\n\t\t.pict-content table th {\n\t\t\tbackground: #F5F0E8;\n\t\t\tborder: 1px solid #DDD6CA;\n\t\t\tpadding: 0.6em 0.8em;\n\t\t\ttext-align: left;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #3D3229;\n\t\t}\n\t\t.pict-content table td {\n\t\t\tborder: 1px solid #DDD6CA;\n\t\t\tpadding: 0.5em 0.8em;\n\t\t\tcolor: #423D37;\n\t\t}\n\t\t.pict-content table tr:nth-child(even) {\n\t\t\tbackground: #F7F5F0;\n\t\t}\n\t\t.pict-content img {\n\t\t\tmax-width: 100%;\n\t\t\theight: auto;\n\t\t}\n\t\t.pict-content pre.mermaid {\n\t\t\tbackground: #fff;\n\t\t\tcolor: #3D3229;\n\t\t\ttext-align: center;\n\t\t\tpadding: 1em;\n\t\t}\n\t\t.pict-content .pict-content-katex-display {\n\t\t\ttext-align: center;\n\t\t\tmargin: 1em 0;\n\t\t\tpadding: 0.5em;\n\t\t\toverflow-x: auto;\n\t\t}\n\t\t.pict-content .pict-content-katex-inline {\n\t\t\tdisplay: inline;\n\t\t}\n\t",Templates:[{Hash:"Pict-Content-Template",Template:'\n<div class="pict-content" id="Pict-Content-Body">\n\t<div class="pict-content-loading">Loading content...</div>\n</div>\n'}],Renderables:[{RenderableHash:"Pict-Content-Display",TemplateHash:"Pict-Content-Template",DestinationAddress:"#Pict-Content-Container",RenderMethod:"replace"}]}},{"pict-view":17}],16:[function(t,e,i){e.exports={name:"pict-view",version:"1.0.66",description:"Pict View Base Class",main:"source/Pict-View.js",scripts:{test:"mocha -u tdd -R spec",tests:"mocha -u tdd -R spec -g",start:"node source/Pict-View.js",coverage:"nyc --reporter=lcov --reporter=text-lcov npm test",build:"npx quack build","docker-dev-build":"docker build ./ -f Dockerfile_LUXURYCode -t pict-view-image:local","docker-dev-run":'docker run -it -d --name pict-view-dev -p 30001:8080 -p 38086:8086 -v "$PWD/.config:/home/coder/.config"  -v "$PWD:/home/coder/pict-view" -u "$(id -u):$(id -g)" -e "DOCKER_USER=$USER" pict-view-image:local',"docker-dev-shell":"docker exec -it pict-view-dev /bin/bash",types:"tsc -p .",lint:"eslint source/**"},types:"types/source/Pict-View.d.ts",repository:{type:"git",url:"git+https://github.com/stevenvelozo/pict-view.git"},author:"steven velozo <steven@velozo.com>",license:"MIT",bugs:{url:"https://github.com/stevenvelozo/pict-view/issues"},homepage:"https://github.com/stevenvelozo/pict-view#readme",devDependencies:{"@eslint/js":"^9.39.1","browser-env":"^3.3.0",eslint:"^9.39.1",pict:"^1.0.348",quackage:"^1.0.51",typescript:"^5.9.3"},mocha:{diff:!0,extension:["js"],package:"./package.json",reporter:"spec",slow:"75",timeout:"5000",ui:"tdd","watch-files":["source/**/*.js","test/**/*.js"],"watch-ignore":["lib/vendor"]},dependencies:{fable:"^3.1.57","fable-serviceproviderbase":"^3.0.18"}}},{}],17:[function(t,e,i){var n=t("fable-serviceproviderbase"),o=t("../package.json"),a={DefaultRenderable:!1,DefaultDestinationAddress:!1,DefaultTemplateRecordAddress:!1,ViewIdentifier:!1,AutoInitialize:!0,AutoInitializeOrdinal:0,AutoRender:!0,AutoRenderOrdinal:0,AutoSolveWithApp:!0,AutoSolveOrdinal:0,CSSHash:!1,CSS:!1,CSSProvider:!1,CSSPriority:500,Templates:[],DefaultTemplates:[],Renderables:[],Manifests:{}},r=function(t){function e(t,i,n){var r;_classCallCheck(this,e),(r=_callSuper(this,e,[t,Object.assign({},JSON.parse(JSON.stringify(a)),i),n])).fable,r.options,r.UUID,r.Hash,r.log;var s=r.Hash===r.UUID;r.UUID="V-".concat(r.UUID),s&&(r.Hash=r.UUID),r.options.ViewIdentifier||(r.options.ViewIdentifier="AutoViewID-".concat(r.fable.getUUID())),r.serviceType="PictView",r._Package=o,r.pict=r.fable,r.AppData=r.pict.AppData,r.Bundle=r.pict.Bundle,r.initializeTimestamp=!1,r.lastSolvedTimestamp=!1,r.lastRenderedTimestamp=!1,r.lastMarshalFromViewTimestamp=!1,r.lastMarshalToViewTimestamp=!1,r.pict.instantiateServiceProviderIfNotExists("TransactionTracking");for(var c=0;c<r.options.Templates.length;c++){var l=r.options.Templates[c];"Hash"in l&&"Template"in l?(l.Source||(l.Source="PictView [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ViewIdentifier," options object.")),r.pict.TemplateProvider.addTemplate(l.Hash,l.Template,l.Source)):r.log.error("PictView [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ViewIdentifier," could not load Template ").concat(c," in the options array."),l)}for(var d=0;d<r.options.DefaultTemplates.length;d++){var p=r.options.DefaultTemplates[d];"Postfix"in p&&"Template"in p?(p.Source||(p.Source="PictView [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ViewIdentifier," options object.")),r.pict.TemplateProvider.addDefaultTemplate(p.Prefix,p.Postfix,p.Template,p.Source)):r.log.error("PictView [".concat(r.UUID,"]::[").concat(r.Hash,"] ").concat(r.options.ViewIdentifier," could not load Default Template ").concat(d," in the options array."),p)}if(r.options.CSS){var h=r.options.CSSHash?r.options.CSSHash:"View-".concat(r.options.ViewIdentifier),u=r.options.CSSProvider?r.options.CSSProvider:h;r.pict.CSSMap.addCSS(h,r.options.CSS,u,r.options.CSSPriority)}r.renderables={};for(var f=0;f<r.options.Renderables.length;f++){var g=r.options.Renderables[f];r.addRenderable(g)}return r}return _inherits(e,t),_createClass(e,[{key:"addRenderable",value:function(t,e,i,n,o){var a;"object"==_typeof(t)?a=t:a={RenderableHash:t,TemplateHash:e,DefaultTemplateRecordAddress:i,ContentDestinationAddress:n,RenderMethod:"string"!=typeof o?o:"replace"};"string"!=typeof a.RenderableHash||"string"!=typeof a.TemplateHash?this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not load Renderable; RenderableHash or TemplateHash are invalid."),a):(this.pict.LogNoisiness>0&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," adding renderable [").concat(a.RenderableHash,"] pointed to template ").concat(a.TemplateHash,".")),this.renderables[a.RenderableHash]=a)}},{key:"onBeforeInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeInitialize:")),!0}},{key:"onBeforeInitializeAsync",value:function(t){return this.onBeforeInitialize(),t()}},{key:"onInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onInitialize:")),!0}},{key:"onInitializeAsync",value:function(t){return this.onInitialize(),t()}},{key:"initialize",value:function(){return this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow VIEW [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," initialize:")),this.initializeTimestamp?(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," initialize called but initialization is already completed.  Aborting.")),!1):(this.onBeforeInitialize(),this.onInitialize(),this.onAfterInitialize(),this.initializeTimestamp=this.pict.log.getTimeStamp(),!0)}},{key:"initializeAsync",value:function(t){var e=this;if(this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow VIEW [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," initializeAsync:")),this.initializeTimestamp)return this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," async initialize called but initialization is already completed.  Aborting.")),t();var i=this.pict.instantiateServiceProviderWithoutRegistration("Anticipate");this.pict.LogNoisiness>0&&this.log.info("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," beginning initialization...")),i.anticipate(this.onBeforeInitializeAsync.bind(this)),i.anticipate(this.onInitializeAsync.bind(this)),i.anticipate(this.onAfterInitializeAsync.bind(this)),i.wait(function(i){return i&&e.log.error("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ViewIdentifier," initialization failed: ").concat(i.message||i),{stack:i.stack}),e.initializeTimestamp=e.pict.log.getTimeStamp(),e.pict.LogNoisiness>0&&e.log.info("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ViewIdentifier," initialization complete.")),t()})}},{key:"onAfterInitialize",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterInitialize:")),!0}},{key:"onAfterInitializeAsync",value:function(t){return this.onAfterInitialize(),t()}},{key:"onBeforeRender",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeRender:")),!0}},{key:"onBeforeRenderAsync",value:function(t,e){return this.onBeforeRender(e),t()}},{key:"onBeforeProject",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeProject:")),!0}},{key:"onBeforeProjectAsync",value:function(t,e){return this.onBeforeProject(e),t()}},{key:"buildRenderOptions",value:function(t,e,i){var n={Valid:!0};return n.RenderableHash="string"==typeof t?t:"string"==typeof this.options.DefaultRenderable&&this.options.DefaultRenderable,n.RenderableHash||(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not find a suitable RenderableHash ").concat(n.RenderableHash," (param ").concat(t,"because it is not a valid renderable.")),n.Valid=!1),n.Renderable=this.renderables[n.RenderableHash],n.Renderable||(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(n.RenderableHash," (param ").concat(t,") because it does not exist.")),n.Valid=!1),n.DestinationAddress="string"==typeof e?e:"string"==typeof n.Renderable.ContentDestinationAddress?n.Renderable.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress&&this.options.DefaultDestinationAddress,n.DestinationAddress||(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(n.RenderableHash," (param ").concat(t,") because it does not have a valid destination address (param ").concat(e,").")),n.Valid=!1),"object"===_typeof(i)?(n.RecordAddress="Passed in as object",n.Record=i):(n.RecordAddress="string"==typeof i?i:"string"==typeof n.Renderable.DefaultTemplateRecordAddress?n.Renderable.DefaultTemplateRecordAddress:"string"==typeof this.options.DefaultTemplateRecordAddress&&this.options.DefaultTemplateRecordAddress,n.Record="string"==typeof n.RecordAddress?this.pict.DataProvider.getDataByAddress(n.RecordAddress):void 0),n}},{key:"assignRenderContent",value:function(t,e,i){return this.pict.ContentAssignment.projectContent(t.RenderMethod,e,i,t.TestAddress)}},{key:"render",value:function(t,e,i,n){return this.renderWithScope(this,t,e,i,n)}},{key:"renderWithScope",value:function(t,e,i,n,o){var a,r,s,c="string"==typeof e?e:"string"==typeof this.options.DefaultRenderable&&this.options.DefaultRenderable;return c?("__Virtual"==c?a={RenderableHash:"__Virtual",TemplateHash:this.renderables[this.options.DefaultRenderable].TemplateHash,ContentDestinationAddress:"string"==typeof i?i:"string"==typeof a.ContentDestinationAddress?a.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress?this.options.DefaultDestinationAddress:null,RenderMethod:"virtual-assignment",TransactionHash:o&&o.TransactionHash,RootRenderableViewHash:o&&o.RootRenderableViewHash}:(a=Object.assign({},this.renderables[c])).ContentDestinationAddress="string"==typeof i?i:"string"==typeof a.ContentDestinationAddress?a.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress?this.options.DefaultDestinationAddress:null,a.TransactionHash||(a.TransactionHash="ViewRender-V-".concat(this.options.ViewIdentifier,"-R-").concat(c,"-U-").concat(this.pict.getUUID()),a.RootRenderableViewHash=this.Hash,this.pict.TransactionTracking.registerTransaction(a.TransactionHash)),a?a.ContentDestinationAddress?("object"===_typeof(n)?(s=n,r="Passed in as object"):s="string"==typeof(r="string"==typeof n?n:"string"==typeof a.DefaultTemplateRecordAddress?a.DefaultTemplateRecordAddress:"string"==typeof this.options.DefaultTemplateRecordAddress&&this.options.DefaultTemplateRecordAddress)?this.pict.DataProvider.getDataByAddress(r):void 0,this.onBeforeRender(a),this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow VIEW [".concat(this.UUID,"]::[").concat(this.Hash,"] Renderable[").concat(c,"] Destination[").concat(a.ContentDestinationAddress,"] TemplateRecordAddress[").concat(r,"] render:")),this.pict.LogNoisiness>0&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," Beginning Render of Renderable[").concat(c,"] to Destination [").concat(a.ContentDestinationAddress,"]...")),a.Content=this.pict.parseTemplateByHash(a.TemplateHash,s,null,[this],t,{RootRenderable:"object"===_typeof(o)?o:a}),this.pict.LogNoisiness>0&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," Assigning Renderable[").concat(c,"] content length ").concat(a.Content.length," to Destination [").concat(a.ContentDestinationAddress,"] using render method [").concat(a.RenderMethod,"].")),this.onBeforeProject(a),this.onProject(a),"virtual-assignment"!==a.RenderMethod&&(this.onAfterProject(a),this.onAfterRender(a)),!0):(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(c," (param ").concat(e,") because it does not have a valid destination address.")),!1):(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(c," (param ").concat(e,") because it does not exist.")),!1)):(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(c," (param ").concat(e,") because it is not a valid renderable.")),!1)}},{key:"renderAsync",value:function(t,e,i,n,o){return this.renderWithScopeAsync(this,t,e,i,n,o)}},{key:"renderWithScopeAsync",value:function(t,e,i,n,o,a){var r,s,c,l=this,d="string"==typeof e?e:"string"==typeof this.options.DefaultRenderable&&this.options.DefaultRenderable,p="function"==typeof a?a:"function"==typeof n?n:"function"==typeof i?i:"function"==typeof e?e:"function"==typeof o?o:null;if(p||(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," renderAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),p=function(t){t&&l.log.error("PictView [".concat(l.UUID,"]::[").concat(l.Hash,"] ").concat(l.options.Name," renderAsync Auto Callback Error: ").concat(t),t)}),!d)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not asynchronously render ").concat(d," (param ").concat(e,"because it is not a valid renderable.")),p(new Error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not asynchronously render ").concat(d," (param ").concat(e,"because it is not a valid renderable.")));if("__Virtual"==d?r={RenderableHash:"__Virtual",TemplateHash:this.renderables[this.options.DefaultRenderable].TemplateHash,ContentDestinationAddress:"string"==typeof i?i:"string"==typeof this.options.DefaultDestinationAddress?this.options.DefaultDestinationAddress:null,RenderMethod:"virtual-assignment",TransactionHash:o&&"function"!=typeof o&&o.TransactionHash,RootRenderableViewHash:o&&"function"!=typeof o&&o.RootRenderableViewHash}:(r=Object.assign({},this.renderables[d])).ContentDestinationAddress="string"==typeof i?i:"string"==typeof r.ContentDestinationAddress?r.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress?this.options.DefaultDestinationAddress:null,r.TransactionHash||(r.TransactionHash="ViewRender-V-".concat(this.options.ViewIdentifier,"-R-").concat(d,"-U-").concat(this.pict.getUUID()),r.RootRenderableViewHash=this.Hash,this.pict.TransactionTracking.registerTransaction(r.TransactionHash)),!r)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(d," (param ").concat(e,") because it does not exist.")),p(new Error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(d," (param ").concat(e,") because it does not exist.")));if(!r.ContentDestinationAddress)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(d," (param ").concat(e,") because it does not have a valid destination address.")),p(new Error("Could not render ".concat(d)));"object"===_typeof(n)?(c=n,s="Passed in as object"):(s="string"==typeof n?n:"string"==typeof r.DefaultTemplateRecordAddress?r.DefaultTemplateRecordAddress:"string"==typeof this.options.DefaultTemplateRecordAddress&&this.options.DefaultTemplateRecordAddress,c="string"==typeof s?this.pict.DataProvider.getDataByAddress(s):void 0),this.pict.LogControlFlow&&this.log.trace("PICT-ControlFlow VIEW [".concat(this.UUID,"]::[").concat(this.Hash,"] Renderable[").concat(d,"] Destination[").concat(r.ContentDestinationAddress,"] TemplateRecordAddress[").concat(s,"] renderAsync:")),this.pict.LogNoisiness>2&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," Beginning Asynchronous Render (callback-style)..."));var h=this.fable.newAnticipate();h.anticipate(function(t){l.onBeforeRenderAsync(t,r)}),h.anticipate(function(i){l.pict.parseTemplateByHash(r.TemplateHash,c,function(t,n){return t?(l.log.error("PictView [".concat(l.UUID,"]::[").concat(l.Hash,"] ").concat(l.options.ViewIdentifier," could not render (asynchronously) ").concat(d," (param ").concat(e,") because it did not parse the template."),t),i(t)):(r.Content=n,i())},[l],t,{RootRenderable:"object"===_typeof(o)?o:r})}),h.anticipate(function(t){l.onBeforeProjectAsync(t,r)}),h.anticipate(function(t){l.onProjectAsync(t,r)}),"virtual-assignment"!==r.RenderMethod&&(h.anticipate(function(t){l.onAfterProjectAsync(t,r)}),h.anticipate(function(t){l.onAfterRenderAsync(t,r)})),h.wait(p)}},{key:"renderDefaultAsync",value:function(t){this.renderAsync(t)}},{key:"basicRender",value:function(t,e,i){return this.basicRenderWithScope(this,t,e,i)}},{key:"basicRenderWithScope",value:function(t,e,i,n){var o=this.buildRenderOptions(e,i,n);return o.Valid?(this.assignRenderContent(o.Renderable,o.DestinationAddress,this.pict.parseTemplateByHash(o.Renderable.TemplateHash,o.Record,null,[this],t,{RootRenderable:o.Renderable})),!0):(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not perform a basic render of ").concat(o.RenderableHash," because it is not valid.")),!1)}},{key:"basicRenderAsync",value:function(t,e,i,n){return this.basicRenderWithScopeAsync(this,t,e,i,n)}},{key:"basicRenderWithScopeAsync",value:function(t,e,i,n,o){var a=this,r="function"==typeof o?o:"function"==typeof n?n:"function"==typeof i?i:"function"==typeof e?e:null;r||(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," basicRenderAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),r=function(t){t&&a.log.error("PictView [".concat(a.UUID,"]::[").concat(a.Hash,"] ").concat(a.options.Name," basicRenderAsync Auto Callback Error: ").concat(t),t)});var s=this.buildRenderOptions(e,i,n);if(!s.Valid){var c="PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not perform a basic render of ").concat(s.RenderableHash," because it is not valid.");return this.log.error(c),r(new Error(c))}this.pict.parseTemplateByHash(s.Renderable.TemplateHash,s.Record,function(t,e){return t?(a.log.error("PictView [".concat(a.UUID,"]::[").concat(a.Hash,"] ").concat(a.options.ViewIdentifier," could not render (asynchronously) ").concat(s.RenderableHash," because it did not parse the template."),t),r(t)):(a.assignRenderContent(s.Renderable,s.DestinationAddress,e),r())},[this],t,{RootRenderable:s.Renderable})}},{key:"onProject",value:function(t){this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onProject:")),"virtual-assignment"===t.RenderMethod&&this.pict.TransactionTracking.pushToTransactionQueue(t.TransactionHash,{ViewHash:this.Hash,Renderable:t},"Deferred-Post-Content-Assignment"),this.pict.LogNoisiness>0&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," Assigning Renderable[").concat(t.RenderableHash,"] content length ").concat(t.Content.length," to Destination [").concat(t.ContentDestinationAddress,"] using Async render method ").concat(t.RenderMethod,".")),this.pict.ContentAssignment.projectContent(t.RenderMethod,t.ContentDestinationAddress,t.Content,t.TestAddress),this.lastRenderedTimestamp=this.pict.log.getTimeStamp()}},{key:"onProjectAsync",value:function(t,e){return this.onProject(e),t()}},{key:"onAfterRender",value:function(t){if(this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterRender:")),t&&t.RootRenderableViewHash===this.Hash){var e,i=_createForOfIteratorHelper(this.pict.TransactionTracking.clearTransactionQueue(t.TransactionHash)||[]);try{for(i.s();!(e=i.n()).done;){var n=e.value,o=this.pict.views[n.Data.ViewHash];o?(o.onAfterProject(),o.onAfterRender(n.Data.Renderable)):this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterRender: Could not find view for transaction hash ").concat(t.TransactionHash," and ViewHash ").concat(n.Data.ViewHash,"."))}}catch(t){i.e(t)}finally{i.f()}}return!0}},{key:"onAfterRenderAsync",value:function(t,e){var i=this;this.onAfterRender(e);var n=this.fable.newAnticipate();if(e&&e.RootRenderableViewHash===this.Hash){var o,a=_createForOfIteratorHelper(this.pict.TransactionTracking.clearTransactionQueue(e.TransactionHash)||[]);try{var r=function(){var t=o.value,a=i.pict.views[t.Data.ViewHash];if(!a)return i.log.error("PictView [".concat(i.UUID,"]::[").concat(i.Hash,"] ").concat(i.options.ViewIdentifier," onAfterRenderAsync: Could not find view for transaction hash ").concat(e.TransactionHash," and ViewHash ").concat(t.Data.ViewHash,".")),1;n.anticipate(a.onAfterProjectAsync.bind(a)),n.anticipate(function(e){a.onAfterRenderAsync(e,t.Data.Renderable)})};for(a.s();!(o=a.n()).done;)r()}catch(t){a.e(t)}finally{a.f()}}return n.wait(t)}},{key:"onAfterProject",value:function(t){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterProject:")),!0}},{key:"onAfterProjectAsync",value:function(t,e){return t()}},{key:"onBeforeSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeSolve:")),!0}},{key:"onBeforeSolveAsync",value:function(t){return this.onBeforeSolve(),t()}},{key:"onSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onSolve:")),!0}},{key:"onSolveAsync",value:function(t){return this.onSolve(),t()}},{key:"solve",value:function(){return this.pict.LogNoisiness>2&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," executing solve() function...")),this.onBeforeSolve(),this.onSolve(),this.onAfterSolve(),this.lastSolvedTimestamp=this.pict.log.getTimeStamp(),!0}},{key:"solveAsync",value:function(t){var e=this,i=this.pict.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t?t:null;n||(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," solveAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," solveAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeSolveAsync.bind(this)),i.anticipate(this.onSolveAsync.bind(this)),i.anticipate(this.onAfterSolveAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ViewIdentifier," solveAsync() complete.")),e.lastSolvedTimestamp=e.pict.log.getTimeStamp(),n(t)})}},{key:"onAfterSolve",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterSolve:")),!0}},{key:"onAfterSolveAsync",value:function(t){return this.onAfterSolve(),t()}},{key:"onBeforeMarshalFromView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeMarshalFromView:")),!0}},{key:"onBeforeMarshalFromViewAsync",value:function(t){return this.onBeforeMarshalFromView(),t()}},{key:"onMarshalFromView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onMarshalFromView:")),!0}},{key:"onMarshalFromViewAsync",value:function(t){return this.onMarshalFromView(),t()}},{key:"marshalFromView",value:function(){return this.pict.LogNoisiness>2&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," executing solve() function...")),this.onBeforeMarshalFromView(),this.onMarshalFromView(),this.onAfterMarshalFromView(),this.lastMarshalFromViewTimestamp=this.pict.log.getTimeStamp(),!0}},{key:"marshalFromViewAsync",value:function(t){var e=this,i=this.pict.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t?t:null;n||(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalFromViewAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalFromViewAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalFromViewAsync.bind(this)),i.anticipate(this.onMarshalFromViewAsync.bind(this)),i.anticipate(this.onAfterMarshalFromViewAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ViewIdentifier," marshalFromViewAsync() complete.")),e.lastMarshalFromViewTimestamp=e.pict.log.getTimeStamp(),n(t)})}},{key:"onAfterMarshalFromView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterMarshalFromView:")),!0}},{key:"onAfterMarshalFromViewAsync",value:function(t){return this.onAfterMarshalFromView(),t()}},{key:"onBeforeMarshalToView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onBeforeMarshalToView:")),!0}},{key:"onBeforeMarshalToViewAsync",value:function(t){return this.onBeforeMarshalToView(),t()}},{key:"onMarshalToView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onMarshalToView:")),!0}},{key:"onMarshalToViewAsync",value:function(t){return this.onMarshalToView(),t()}},{key:"marshalToView",value:function(){return this.pict.LogNoisiness>2&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," executing solve() function...")),this.onBeforeMarshalToView(),this.onMarshalToView(),this.onAfterMarshalToView(),this.lastMarshalToViewTimestamp=this.pict.log.getTimeStamp(),!0}},{key:"marshalToViewAsync",value:function(t){var e=this,i=this.pict.instantiateServiceProviderWithoutRegistration("Anticipate"),n="function"==typeof t?t:null;n||(this.log.warn("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.Name," marshalToViewAsync was called without a valid callback.  A callback will be generated but this could lead to race conditions.")),n=function(t){t&&e.log.error("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.Name," marshalToViewAsync Auto Callback Error: ").concat(t),t)}),i.anticipate(this.onBeforeMarshalToViewAsync.bind(this)),i.anticipate(this.onMarshalToViewAsync.bind(this)),i.anticipate(this.onAfterMarshalToViewAsync.bind(this)),i.wait(function(t){return e.pict.LogNoisiness>2&&e.log.trace("PictView [".concat(e.UUID,"]::[").concat(e.Hash,"] ").concat(e.options.ViewIdentifier," marshalToViewAsync() complete.")),e.lastMarshalToViewTimestamp=e.pict.log.getTimeStamp(),n(t)})}},{key:"onAfterMarshalToView",value:function(){return this.pict.LogNoisiness>3&&this.log.trace("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," onAfterMarshalToView:")),!0}},{key:"onAfterMarshalToViewAsync",value:function(t){return this.onAfterMarshalToView(),t()}},{key:"isPictView",get:function(){return!0}}])}(n);e.exports=r},{"../package.json":16,"fable-serviceproviderbase":7}],18:[function(t,e,i){e.exports={DefaultRenderable:"MarkdownEditor-Wrap",DefaultDestinationAddress:"#MarkdownEditor-Container-Div",Templates:[{Hash:"MarkdownEditor-Container",Template:'<div class="pict-mde" id="PictMDE-Container"></div>'},{Hash:"MarkdownEditor-Segment",Template:'<div class="pict-mde-segment" id="PictMDE-Segment-{~D:Record.SegmentIndex~}" data-segment-index="{~D:Record.SegmentIndex~}">\n\t<div class="pict-mde-left-controls">\n\t\t<button type="button" class="pict-mde-left-btn pict-mde-left-btn-remove" onclick="{~D:Record.ViewIdentifier~}.removeSegment({~D:Record.SegmentIndex~})" title="Remove Segment">&times;</button>\n\t\t<div class="pict-mde-left-controls-bottom">\n\t\t\t<button type="button" class="pict-mde-left-btn pict-mde-left-btn-move" onclick="{~D:Record.ViewIdentifier~}.moveSegmentUp({~D:Record.SegmentIndex~})" title="Move Up">&uarr;</button>\n\t\t\t<button type="button" class="pict-mde-left-btn pict-mde-left-btn-linenums" onclick="{~D:Record.ViewIdentifier~}.toggleLineNumbers()" title="Toggle Line Numbers">1</button>\n\t\t\t<button type="button" class="pict-mde-left-btn pict-mde-left-btn-preview" onclick="{~D:Record.ViewIdentifier~}.toggleSegmentPreview({~D:Record.SegmentIndex~})" title="Toggle Preview">&#x25CE;</button>\n\t\t\t<button type="button" class="pict-mde-left-btn pict-mde-left-btn-move" onclick="{~D:Record.ViewIdentifier~}.moveSegmentDown({~D:Record.SegmentIndex~})" title="Move Down">&darr;</button>\n\t\t</div>\n\t</div>\n\t<div class="pict-mde-drag-handle" draggable="true" title="Drag to reorder"></div>\n\t<div class="pict-mde-segment-body">\n\t\t<div class="pict-mde-segment-editor" id="PictMDE-SegmentEditor-{~D:Record.SegmentIndex~}"></div>\n\t\t<div class="pict-mde-image-preview" id="PictMDE-ImagePreview-{~D:Record.SegmentIndex~}"></div>\n\t\t<div class="pict-mde-rich-preview" id="PictMDE-RichPreview-{~D:Record.SegmentIndex~}"></div>\n\t</div>\n\t<div class="pict-mde-sidebar" id="PictMDE-Sidebar-{~D:Record.SegmentIndex~}">\n\t\t<div class="pict-mde-sidebar-actions">\n\t\t\t<button type="button" class="pict-mde-sidebar-btn" onclick="{~D:Record.ViewIdentifier~}.applyFormatting({~D:Record.SegmentIndex~}, \'bold\')" title="Bold (Ctrl+B)"><b>B</b></button>\n\t\t\t<button type="button" class="pict-mde-sidebar-btn" onclick="{~D:Record.ViewIdentifier~}.applyFormatting({~D:Record.SegmentIndex~}, \'italic\')" title="Italic (Ctrl+I)"><i>I</i></button>\n\t\t\t<button type="button" class="pict-mde-sidebar-btn" onclick="{~D:Record.ViewIdentifier~}.applyFormatting({~D:Record.SegmentIndex~}, \'code\')" title="Inline Code (Ctrl+E)"><code>&lt;&gt;</code></button>\n\t\t\t<button type="button" class="pict-mde-sidebar-btn" onclick="{~D:Record.ViewIdentifier~}.applyFormatting({~D:Record.SegmentIndex~}, \'heading\')" title="Heading">#</button>\n\t\t\t<button type="button" class="pict-mde-sidebar-btn" onclick="{~D:Record.ViewIdentifier~}.applyFormatting({~D:Record.SegmentIndex~}, \'link\')" title="Link">[&thinsp;]</button>\n\t\t\t<button type="button" class="pict-mde-sidebar-btn pict-mde-sidebar-btn-image" onclick="{~D:Record.ViewIdentifier~}.openImagePicker({~D:Record.SegmentIndex~})" title="Insert Image">&#x25A3;</button>\n\t\t</div>\n\t\t<input type="file" accept="image/*" class="pict-mde-image-input" id="PictMDE-ImageInput-{~D:Record.SegmentIndex~}" style="display:none" />\n\t</div>\n</div>'},{Hash:"MarkdownEditor-AddSegment",Template:'<div class="pict-mde-add-segment">\n\t<button type="button" class="pict-mde-btn-add" onclick="{~D:Record.ViewIdentifier~}.addSegment()">+ Add Segment</button>\n</div>'}],Renderables:[{RenderableHash:"MarkdownEditor-Wrap",TemplateHash:"MarkdownEditor-Container",DestinationAddress:"#MarkdownEditor-Container-Div"}],TargetElementAddress:"#MarkdownEditor-Container-Div",ContentDataAddress:!1,ReadOnly:!1,EnableRichPreview:!0,CSS:"\n/* ---- Container ---- */\n.pict-mde\n{\n\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n\tfont-size: 14px;\n}\n\n/* ---- Segment row: left-controls | drag-handle | editor body | sidebar ---- */\n.pict-mde-segment\n{\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: stretch;\n\tmargin-bottom: 6px;\n\tmin-height: 48px;\n\ttransition: background-color 0.15s ease;\n}\n\n/* ---- Left controls ( top,  bottom) ---- */\n.pict-mde-left-controls\n{\n\tflex: 0 0 22px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 2px 0;\n}\n.pict-mde-left-btn-remove\n{\n\tposition: sticky;\n\ttop: 2px;\n\tz-index: 2;\n}\n.pict-mde-left-controls-bottom\n{\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tgap: 1px;\n\tposition: sticky;\n\tbottom: 2px;\n\tz-index: 2;\n}\n.pict-mde-left-btn\n{\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 20px;\n\theight: 20px;\n\tborder: none;\n\tbackground: transparent;\n\tcursor: pointer;\n\tfont-size: 12px;\n\tpadding: 0;\n\tcolor: #888;\n\tline-height: 1;\n\tfont-family: inherit;\n\topacity: 0;\n\ttransition: opacity 0.15s ease;\n}\n.pict-mde-segment:hover .pict-mde-left-btn,\n.pict-mde-segment.pict-mde-active .pict-mde-left-btn\n{\n\topacity: 1;\n}\n.pict-mde-left-btn:hover\n{\n\tcolor: #222;\n}\n.pict-mde-left-btn-remove:hover\n{\n\tcolor: #CC3333;\n}\n.pict-mde-left-btn-linenums\n{\n\tfont-size: 11px;\n\tfont-weight: 600;\n\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', monospace;\n}\n/* Highlight when line numbers are active */\n.pict-mde.pict-mde-linenums-on .pict-mde-left-btn-linenums\n{\n\tcolor: #4A90D9;\n}\n.pict-mde-left-btn-preview\n{\n\tfont-size: 11px;\n}\n/* Highlight the preview button when preview is visible (not hidden) */\n.pict-mde-segment:not(.pict-mde-preview-hidden) .pict-mde-left-btn-preview\n{\n\tcolor: #4A90D9;\n}\n/* Dim preview button when this segment's preview is individually hidden */\n.pict-mde-segment.pict-mde-preview-hidden .pict-mde-left-btn-preview\n{\n\tcolor: #CCC;\n}\n\n/* ---- Drag handle (simple grey bar) ---- */\n.pict-mde-drag-handle\n{\n\tflex: 0 0 8px;\n\tcursor: grab;\n\tbackground: #EDEDED;\n\ttransition: background-color 0.15s ease;\n\tuser-select: none;\n}\n.pict-mde-drag-handle:active\n{\n\tcursor: grabbing;\n}\n.pict-mde-drag-handle:hover\n{\n\tbackground: #C8C8C8;\n}\n\n/* ---- Editor body (middle column) ---- */\n.pict-mde-segment-body\n{\n\tflex: 1 1 auto;\n\tmin-width: 0;\n\tbackground: #FFFFFF;\n\ttransition: background-color 0.15s ease;\n}\n.pict-mde-segment-editor\n{\n\tmin-height: 48px;\n}\n\n/* ---- Image preview area below the editor ---- */\n.pict-mde-image-preview\n{\n\tdisplay: none;\n}\n.pict-mde-image-preview.pict-mde-has-images\n{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tgap: 8px;\n\tpadding: 8px 12px;\n\tborder-top: 1px solid #EDEDED;\n}\n.pict-mde-image-preview img\n{\n\tmax-width: 200px;\n\tmax-height: 150px;\n\tborder-radius: 3px;\n\tborder: 1px solid #E0E0E0;\n\tobject-fit: contain;\n\tbackground: #F8F8F8;\n}\n.pict-mde-image-preview-item\n{\n\tposition: relative;\n\tdisplay: inline-block;\n}\n.pict-mde-image-preview-label\n{\n\tdisplay: block;\n\tfont-size: 10px;\n\tcolor: #999;\n\tmargin-top: 2px;\n\tmax-width: 200px;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n/* ---- Rich content preview area (rendered via pict-section-content) ---- */\n.pict-mde-rich-preview\n{\n\tdisplay: none;\n}\n.pict-mde-rich-preview.pict-mde-has-rich-preview\n{\n\tdisplay: block;\n\tborder-top: 1px solid #EDEDED;\n\tbackground: #FCFCFC;\n}\n/* Global preview toggle: hide all previews when container has class */\n.pict-mde.pict-mde-previews-hidden .pict-mde-rich-preview.pict-mde-has-rich-preview,\n.pict-mde.pict-mde-previews-hidden .pict-mde-image-preview.pict-mde-has-images\n{\n\tdisplay: none;\n}\n/* Per-segment preview toggle: hide previews for a specific segment */\n.pict-mde-segment.pict-mde-preview-hidden .pict-mde-rich-preview.pict-mde-has-rich-preview,\n.pict-mde-segment.pict-mde-preview-hidden .pict-mde-image-preview.pict-mde-has-images\n{\n\tdisplay: none;\n}\n/* Constrain the pict-content inside the preview to fit the segment */\n.pict-mde-rich-preview .pict-content\n{\n\tpadding: 12px;\n\tmax-width: none;\n\tmargin: 0;\n\tfont-size: 13px;\n}\n/* Reduce heading sizes in the preview to be proportional */\n.pict-mde-rich-preview .pict-content h1\n{\n\tfont-size: 1.4em;\n\tmargin-top: 0;\n}\n.pict-mde-rich-preview .pict-content h2\n{\n\tfont-size: 1.2em;\n\tmargin-top: 0.75em;\n}\n.pict-mde-rich-preview .pict-content h3\n{\n\tfont-size: 1.1em;\n\tmargin-top: 0.6em;\n}\n\n/* Focused / active editor gets subtle warm background */\n.pict-mde-segment.pict-mde-active .pict-mde-segment-body\n{\n\tbackground: #FAFAF5;\n}\n.pict-mde-segment.pict-mde-active .pict-mde-drag-handle\n{\n\tbackground: #9CB4C8;\n}\n\n/* ---- Right sidebar (formatting buttons) ---- */\n.pict-mde-sidebar\n{\n\tflex: 0 0 30px;\n\tdisplay: flex;\n\talign-items: flex-start;\n\tposition: relative;\n}\n\n.pict-mde-sidebar-actions\n{\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tgap: 1px;\n\tpadding: 4px 0;\n\twidth: 100%;\n\topacity: 0;\n\ttransition: opacity 0.15s ease, top 0.1s ease;\n\tposition: sticky;\n\ttop: 0;\n}\n/* Active segment always shows its sidebar */\n.pict-mde-segment.pict-mde-active .pict-mde-sidebar-actions\n{\n\topacity: 1;\n}\n/* When no segment is active, hovering shows both left + right controls */\n.pict-mde:not(:has(.pict-mde-active)) .pict-mde-segment:hover .pict-mde-sidebar-actions\n{\n\topacity: 1;\n}\n/* When JS sets a cursor-relative offset, switch from sticky to absolute positioning */\n.pict-mde-sidebar-actions.pict-mde-sidebar-at-cursor\n{\n\tposition: absolute;\n\ttop: var(--pict-mde-sidebar-top, 0px);\n}\n\n.pict-mde-sidebar-btn\n{\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 24px;\n\theight: 22px;\n\tborder: none;\n\tbackground: transparent;\n\tcursor: pointer;\n\tfont-size: 12px;\n\tpadding: 0;\n\tborder-radius: 3px;\n\tcolor: #666;\n\tline-height: 1;\n\tfont-family: inherit;\n}\n.pict-mde-sidebar-btn:hover\n{\n\tcolor: #222;\n}\n.pict-mde-sidebar-btn b\n{\n\tfont-size: 13px;\n\tfont-weight: 700;\n}\n.pict-mde-sidebar-btn i\n{\n\tfont-size: 13px;\n\tfont-style: italic;\n}\n.pict-mde-sidebar-btn code\n{\n\tfont-size: 10px;\n\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', monospace;\n}\n\n/* ---- Add segment button ---- */\n.pict-mde-add-segment\n{\n\tmargin-top: 6px;\n\tpadding-left: 30px;\n}\n.pict-mde-btn-add\n{\n\tdisplay: block;\n\twidth: 100%;\n\tpadding: 7px;\n\tborder: 2px dashed #D0D0D0;\n\tborder-radius: 4px;\n\tbackground: transparent;\n\tcolor: #999;\n\tfont-size: 12px;\n\tfont-weight: 600;\n\tcursor: pointer;\n\ttransition: all 0.15s ease;\n}\n.pict-mde-btn-add:hover\n{\n\tborder-color: #4A90D9;\n\tcolor: #4A90D9;\n\tbackground: rgba(74, 144, 217, 0.04);\n}\n\n/* ---- Image drag-over indicator ---- */\n.pict-mde-segment-editor.pict-mde-image-dragover\n{\n\toutline: 2px dashed #4A90D9;\n\toutline-offset: -2px;\n}\n\n/* ---- Drag-in-progress: prevent CodeMirror from intercepting drop events ---- */\n.pict-mde.pict-mde-dragging .pict-mde-segment-editor\n{\n\tpointer-events: none;\n}\n\n/* ---- Drop target indicators for drag reorder ---- */\n.pict-mde-segment.pict-mde-drag-over-top\n{\n\tbox-shadow: 0 -2px 0 0 #4A90D9;\n}\n.pict-mde-segment.pict-mde-drag-over-bottom\n{\n\tbox-shadow: 0 2px 0 0 #4A90D9;\n}\n\n/* ---- CodeMirror overrides inside segments ---- */\n.pict-mde-segment-editor .cm-editor\n{\n\tborder: none;\n}\n.pict-mde-segment-editor .cm-editor .cm-scroller\n{\n\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', 'Consolas', 'Liberation Mono', 'Courier New', monospace;\n\tfont-size: 14px;\n\tline-height: 1.6;\n}\n.pict-mde-segment-editor .cm-editor.cm-focused\n{\n\toutline: none;\n}\n.pict-mde-segment-editor .cm-editor .cm-content\n{\n\tpadding: 8px 12px;\n\tmin-height: 36px;\n}\n.pict-mde-segment-editor .cm-editor .cm-gutters\n{\n\tbackground: #F8F8F8;\n\tborder-right: 1px solid #E8E8E8;\n\tcolor: #BBB;\n}\n\n/* ---- Collapsed data URI widget ---- */\n.pict-mde-data-uri-collapsed\n{\n\tdisplay: inline;\n\tbackground: #F0F0F0;\n\tcolor: #888;\n\tfont-size: 11px;\n\tpadding: 1px 4px;\n\tborder-radius: 3px;\n\tborder: 1px solid #E0E0E0;\n\tfont-family: 'SFMono-Regular', 'SF Mono', 'Menlo', monospace;\n\tcursor: default;\n\twhite-space: nowrap;\n}\n\n/* ---- Line number toggle: hidden by default, shown when class present ---- */\n.pict-mde .cm-editor .cm-gutters\n{\n\tdisplay: none;\n}\n.pict-mde.pict-mde-linenums-on .cm-editor .cm-gutters\n{\n\tdisplay: flex;\n}\n"}},{}],19:[function(t,e,i){var n=t("pict-view"),o=t("pict-section-content"),a=o.PictContentProvider,r=t("./Pict-Section-MarkdownEditor-DefaultConfiguration.js"),s={bold:{wrap:"**"},italic:{wrap:"*"},code:{wrap:"`"},heading:{prefix:"# "},link:{before:"[",after:"](url)"}},c=function(t){function e(t,i,n){var o;return _classCallCheck(this,e),(o=_callSuper(this,e,[t,Object.assign({},r,i),n])).initialRenderComplete=!1,o._codeMirrorModules=null,o._segmentEditors={},o._segmentCounter=0,o._viewCallIdentifier=!1,o._activeSegmentIndex=-1,o._dragSourceIndex=-1,o._lineNumbersVisible=!1,o._previewsVisible=!0,o._hiddenPreviewSegments={},o._imagePreviewTimers={},o._richPreviewTimers={},o._richPreviewGenerations={},o._contentProvider=null,o}return _inherits(e,t),_createClass(e,[{key:"onBeforeInitialize",value:function(){return _superPropGet(e,"onBeforeInitialize",this,3)([]),this.targetElement=!1,_superPropGet(e,"onBeforeInitialize",this,3)([])}},{key:"connectCodeMirrorModules",value:function(t){if(!t||"object"!==_typeof(t)||"function"!=typeof t.EditorView||"function"!=typeof t.EditorState)return"undefined"!=typeof window&&window.CodeMirrorModules&&"function"==typeof window.CodeMirrorModules.EditorView?(this.log.trace("PICT-MarkdownEditor Found CodeMirror modules on window.CodeMirrorModules."),void(this._codeMirrorModules=window.CodeMirrorModules)):(this.log.error("PICT-MarkdownEditor No CodeMirror modules found. Provide them via connectCodeMirrorModules() or set window.CodeMirrorModules."),!1);this._codeMirrorModules=t}},{key:"onAfterRender",value:function(t){return this.pict.CSSMap.injectCSS(),this.initialRenderComplete||(this.onAfterInitialRender(),this.initialRenderComplete=!0),_superPropGet(e,"onAfterRender",this,3)([t])}},{key:"onAfterInitialRender",value:function(){if(this._codeMirrorModules||this.connectCodeMirrorModules(),!this._codeMirrorModules)return this.log.error("PICT-MarkdownEditor Cannot initialize; no CodeMirror modules available."),!1;if(this.options.EnableRichPreview){var t=o.default_configuration;t&&t.CSS&&this.pict.CSSMap.addCSS("Pict-Content-View",t.CSS)}var e=this.services.ContentAssignment.getElement(this.options.TargetElementAddress);if(!e||e.length<1)return this.log.error("PICT-MarkdownEditor Could not find target element [".concat(this.options.TargetElementAddress,"]!")),this.targetElement=!1,!1;this.targetElement=e[0],this._viewCallIdentifier=this._resolveViewCallIdentifier(),this._buildEditorUI()}},{key:"_resolveViewCallIdentifier",value:function(){var t=this.pict.views;for(var e in t)if(t[e]===this)return"_Pict.views.".concat(e);return"_Pict.servicesMap.PictView['".concat(this.Hash,"']")}},{key:"_getContainerElement",value:function(){if(this.targetElement){var t=this.targetElement.querySelector(".pict-mde");if(t)return t}return this.targetElement||null}},{key:"_buildEditorUI",value:function(){var t=this._getContainerElement();for(var e in t&&!t.classList.contains("pict-mde")&&t.classList.add("pict-mde"),this._segmentEditors)this._segmentEditors[e]&&this._segmentEditors[e].destroy();t.innerHTML="",this._previewsVisible||t.classList.add("pict-mde-previews-hidden"),this._lineNumbersVisible&&t.classList.add("pict-mde-linenums-on");var i=this._getSegmentsFromData();i&&0!==i.length||(i=[{Content:""}],this._setSegmentsToData(i)),this._segmentCounter=0,this._segmentEditors={};for(var n=0;n<i.length;n++)this._renderSegment(t,n,i[n].Content||"");this._renderAddButton(t)}},{key:"_renderSegment",value:function(t,e,i){var n=this._segmentCounter++,o={SegmentIndex:n,SegmentDisplayIndex:e+1,ViewIdentifier:this._viewCallIdentifier},a=this.pict.parseTemplateByHash("MarkdownEditor-Segment",o),r=document.createElement("div");r.innerHTML=a;var s=r.firstElementChild;t.appendChild(s),this._hiddenPreviewSegments[e]&&s.classList.add("pict-mde-preview-hidden"),this._wireSegmentDragEvents(s,n);var c=document.getElementById("PictMDE-SegmentEditor-".concat(n));c&&(this._createEditorInContainer(c,n,i),this._wireImageDragEvents(c,n),i&&(this._updateImagePreviews(n),this._updateRichPreviews(n)))}},{key:"_wireSegmentDragEvents",value:function(t,e){var i=t.querySelector(".pict-mde-drag-handle");if(i){var n=this;i.addEventListener("dragstart",function(i){n._dragSourceIndex=e,i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",String(e));var o=n._getContainerElement();o&&o.classList.add("pict-mde-dragging"),setTimeout(function(){t.style.opacity="0.4"},0)}),i.addEventListener("dragend",function(){t.style.opacity="",n._dragSourceIndex=-1,n._clearAllDropIndicators();var e=n._getContainerElement();e&&e.classList.remove("pict-mde-dragging")}),t.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",n._clearAllDropIndicators();var i=t.getBoundingClientRect(),o=i.top+i.height/2;e.clientY<o?t.classList.add("pict-mde-drag-over-top"):t.classList.add("pict-mde-drag-over-bottom")}),t.addEventListener("dragleave",function(e){t.contains(e.relatedTarget)||(t.classList.remove("pict-mde-drag-over-top"),t.classList.remove("pict-mde-drag-over-bottom"))}),t.addEventListener("drop",function(i){i.preventDefault();var o=t.classList.contains("pict-mde-drag-over-bottom");n._clearAllDropIndicators();var a=n._dragSourceIndex;a<0||a===e||n._reorderSegment(a,e,o)})}}},{key:"_clearAllDropIndicators",value:function(){var t=this._getContainerElement();if(t)for(var e=t.querySelectorAll(".pict-mde-segment"),i=0;i<e.length;i++)e[i].classList.remove("pict-mde-drag-over-top"),e[i].classList.remove("pict-mde-drag-over-bottom")}},{key:"_wireImageDragEvents",value:function(t,e){var i=this;t.addEventListener("dragover",function(e){i._dragSourceIndex>=0||!e.dataTransfer||!e.dataTransfer.types||e.dataTransfer.types.indexOf("Files")<0||(e.preventDefault(),e.dataTransfer.dropEffect="copy",t.classList.add("pict-mde-image-dragover"))}),t.addEventListener("dragleave",function(e){t.contains(e.relatedTarget)||t.classList.remove("pict-mde-image-dragover")}),t.addEventListener("drop",function(n){if(t.classList.remove("pict-mde-image-dragover"),!(i._dragSourceIndex>=0)&&n.dataTransfer&&n.dataTransfer.files&&!(n.dataTransfer.files.length<1)){var o=n.dataTransfer.files[0];o.type&&o.type.startsWith("image/")&&(n.preventDefault(),n.stopPropagation(),i._processImageFile(o,e))}})}},{key:"_reorderSegment",value:function(t,e,i){var n=this._getLogicalIndex(t),o=this._getLogicalIndex(e);if(n<0||o<0)this.log.warn("PICT-MarkdownEditor _reorderSegment: could not resolve logical indices (from=".concat(n,", to=").concat(o,")."));else if(n!==o){this._marshalAllEditorsToData();var a=this._getSegmentsFromData();if(a&&!(a.length<2)){var r=i?o+1:o;if(n<r&&r--,r!==n){var s=a.splice(n,1)[0];a.splice(r,0,s),this._setSegmentsToData(a),this._reorderHiddenPreviewState(n,r),this._buildEditorUI()}}}}},{key:"_createEditorInContainer",value:function(t,e,i){var n=this._codeMirrorModules,o=this,a=[];n.extensions&&Array.isArray(n.extensions)&&(a=a.concat(n.extensions)),a.push(n.EditorView.updateListener.of(function(t){t.docChanged&&o._onSegmentContentChange(e,t.state.doc.toString()),t.focusChanged&&(t.view.hasFocus?(o._setActiveSegment(e),o._updateSidebarPosition(e)):setTimeout(function(){if(o._activeSegmentIndex===e){var t=document.getElementById("PictMDE-Segment-".concat(e));t&&!t.contains(document.activeElement)&&(o._clearActiveSegment(e),o._resetSidebarPosition(e))}},100)),t.selectionSet&&t.view.hasFocus&&o._updateSidebarPosition(e)})),a.push(n.EditorView.domEventHandlers({keydown:function(t,i){return(t.ctrlKey||t.metaKey)&&"b"===t.key?(t.preventDefault(),o.applyFormatting(e,"bold"),!0):(t.ctrlKey||t.metaKey)&&"i"===t.key?(t.preventDefault(),o.applyFormatting(e,"italic"),!0):(t.ctrlKey||t.metaKey)&&"e"===t.key?(t.preventDefault(),o.applyFormatting(e,"code"),!0):void 0},paste:function(t,i){var n=t.clipboardData&&t.clipboardData.items;if(!n)return!1;for(var a=0;a<n.length;a++)if(n[a].type.startsWith("image/")){t.preventDefault();var r=n[a].getAsFile();return r&&o._processImageFile(r,e),!0}return!1}}));var r=this._buildDataURICollapseExtension();r&&a.push(r),this.options.ReadOnly&&(a.push(n.EditorState.readOnly.of(!0)),a.push(n.EditorView.editable.of(!1))),a=this.customConfigureExtensions(a,e);var s=n.EditorState.create({doc:i||"",extensions:a}),c=new n.EditorView({state:s,parent:t});this._segmentEditors[e]=c}},{key:"customConfigureExtensions",value:function(t,e){return t}},{key:"_buildDataURICollapseExtension",value:function(){var t=this._codeMirrorModules;if(!(t&&t.Decoration&&t.ViewPlugin&&t.WidgetType))return null;var e=t.Decoration,i=t.ViewPlugin,n=t.WidgetType,o=function(t){function e(t){var i;return _classCallCheck(this,e),(i=_callSuper(this,e)).label=t,i}return _inherits(e,t),_createClass(e,[{key:"toDOM",value:function(){var t=document.createElement("span");return t.className="pict-mde-data-uri-collapsed",t.textContent=this.label,t.title="Data URI (click to expand in image preview below)",t}},{key:"eq",value:function(t){return this.label===t.label}}])}(n);function a(t){var i,n=[],a=t.state.doc,r=_createForOfIteratorHelper(t.visibleRanges);try{for(r.s();!(i=r.n()).done;)for(var s=i.value,c=s.from,l=s.to,d=a.sliceString(c,l),p=/!\[[^\]]*\]\(data:([^;]+);base64,/g,h=void 0;null!==(h=p.exec(d));){for(var u=c+h.index+h[0].length,f=-1,g=u,m=a.length,v=Math.min(m,g+5242880),y=g;y<v;y+=4096){var b=Math.min(y+4096,v),w=a.sliceString(y,b).indexOf(")");if(w>=0){f=y+w;break}}if(!(f<0)){var A=f-u;if(!(A<200)){var I=Math.round(.75*A),D=void 0;D=I>=1048576?(I/1048576).toFixed(1)+"MB":I>=1024?Math.round(I/1024)+"KB":I+"B";h[1];var P="".concat(D,")"),k=e.replace({widget:new o(P)});n.push(k.range(u,f+1))}}}}catch(t){r.e(t)}finally{r.f()}return e.set(n,!0)}return i.fromClass(function(){return _createClass(function t(e){_classCallCheck(this,t),this.decorations=a(e)},[{key:"update",value:function(t){(t.docChanged||t.viewportChanged)&&(this.decorations=a(t.view))}}])}(),{decorations:function(t){return t.decorations}})}},{key:"_renderAddButton",value:function(t){var e={ViewIdentifier:this._viewCallIdentifier},i=this.pict.parseTemplateByHash("MarkdownEditor-AddSegment",e),n=document.createElement("div");n.innerHTML=i;var o=n.firstElementChild;t.appendChild(o)}},{key:"_setActiveSegment",value:function(t){if(this._activeSegmentIndex>=0&&this._activeSegmentIndex!==t){var e=document.getElementById("PictMDE-Segment-".concat(this._activeSegmentIndex));e&&e.classList.remove("pict-mde-active")}this._activeSegmentIndex=t;var i=document.getElementById("PictMDE-Segment-".concat(t));i&&i.classList.add("pict-mde-active")}},{key:"_clearActiveSegment",value:function(t){this._activeSegmentIndex===t&&(this._activeSegmentIndex=-1);var e=document.getElementById("PictMDE-Segment-".concat(t));e&&e.classList.remove("pict-mde-active"),this._resetSidebarPosition(t)}},{key:"applyFormatting",value:function(t,e){var i=this._segmentEditors[t];if(i){var n=s[e];if(n){var o,a,r=i.state,c=r.selection.main,l=c.from,d=c.to,p=l!==d,h=p?r.sliceDoc(l,d):"";if(n.wrap){var u=n.wrap;if(p){var f=r.sliceDoc(Math.max(0,l-u.length),l),g=r.sliceDoc(d,Math.min(r.doc.length,d+u.length));if(f===u&&g===u)return o=[{from:l-u.length,to:l,insert:""},{from:d,to:d+u.length,insert:""}],a=l-u.length,void i.dispatch({changes:o,selection:{anchor:a,head:a+h.length}});o={from:l,to:d,insert:u+h+u},a=l+u.length,i.dispatch({changes:o,selection:{anchor:a,head:a+h.length}})}else{o={from:l,insert:u+u},a=l+u.length,i.dispatch({changes:o,selection:{anchor:a}})}}else if(n.prefix){var m=r.doc.lineAt(l);o=m.text.startsWith(n.prefix)?{from:m.from,to:m.from+n.prefix.length,insert:""}:{from:m.from,insert:n.prefix},i.dispatch({changes:o})}else if(n.before&&n.after){if(p)o={from:l,to:d,insert:n.before+h+n.after},a=l+n.before.length+h.length+2,i.dispatch({changes:o,selection:{anchor:a,head:a+3}});else o={from:l,insert:n.before+n.after},a=l+n.before.length,i.dispatch({changes:o,selection:{anchor:a}})}i.focus()}else this.log.warn('PICT-MarkdownEditor applyFormatting: unknown format type "'.concat(e,'".'))}else this.log.warn("PICT-MarkdownEditor applyFormatting: no editor for segment ".concat(t,"."))}},{key:"openImagePicker",value:function(t){var e=document.getElementById("PictMDE-ImageInput-".concat(t));if(e){var i=this;e.onchange=function(){e.files&&e.files.length>0&&i._processImageFile(e.files[0],t),e.value=""},e.click()}else this.log.warn("PICT-MarkdownEditor openImagePicker: file input not found for segment ".concat(t,"."))}},{key:"_processImageFile",value:function(t,e){if(t&&t.type&&t.type.startsWith("image/")){var i=this,n=t.name?t.name.replace(/\.[^.]+$/,""):"image";if(!this.onImageUpload(t,e,function(t,o){t?i.log.error("PICT-MarkdownEditor image upload error: ".concat(t)):o&&i._insertImageMarkdown(e,o,n)}))if("undefined"!=typeof FileReader){var o=new FileReader;o.onload=function(){i._insertImageMarkdown(e,o.result,n)},o.onerror=function(){i.log.error("PICT-MarkdownEditor _processImageFile: FileReader error.")},o.readAsDataURL(t)}else this.log.error("PICT-MarkdownEditor _processImageFile: FileReader not available in this environment.")}else this.log.warn("PICT-MarkdownEditor _processImageFile: not an image file (type: ".concat(t?t.type:"null",")."))}},{key:"_insertImageMarkdown",value:function(t,e,i){var n=this._segmentEditors[t];if(n){var o="![".concat(i||"image","](").concat(e,")"),a=n.state.selection.main.head;n.dispatch({changes:{from:a,insert:o},selection:{anchor:a+o.length}}),n.focus(),this._updateImagePreviews(t)}else this.log.warn("PICT-MarkdownEditor _insertImageMarkdown: no editor for segment ".concat(t,"."))}},{key:"onImageUpload",value:function(t,e,i){return!1}},{key:"_updateImagePreviews",value:function(t){var e=document.getElementById("PictMDE-ImagePreview-".concat(t));if(e){var i=this._segmentEditors[t];if(!i)return e.innerHTML="",void e.classList.remove("pict-mde-has-images");for(var n,o=i.state.doc.toString(),a=/!\[([^\]]*)\]\(([^)]+)\)/g,r=[];null!==(n=a.exec(o));)r.push({alt:n[1]||"image",url:n[2]});if(0===r.length)return e.innerHTML="",void e.classList.remove("pict-mde-has-images");for(var s="",c=0;c<r.length;c++){var l=r[c].alt.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),d=r[c].url.replace(/&/g,"&amp;").replace(/"/g,"&quot;");s+='<div class="pict-mde-image-preview-item"><img src="'.concat(d,'" alt="').concat(l,'" /><span class="pict-mde-image-preview-label">').concat(l,"</span></div>")}e.innerHTML=s,e.classList.add("pict-mde-has-images")}}},{key:"_getContentProvider",value:function(){return this._contentProvider||(this._contentProvider=new a(this.fable,{},"Pict-Content-Provider-MDE")),this._contentProvider}},{key:"_updateRichPreviews",value:function(t){if(this.options.EnableRichPreview){var e=document.getElementById("PictMDE-RichPreview-".concat(t));if(e){var i=this._segmentEditors[t];if(!i)return e.innerHTML="",void e.classList.remove("pict-mde-has-rich-preview");var n=i.state.doc.toString();if(!n||0===n.trim().length)return e.innerHTML="",void e.classList.remove("pict-mde-has-rich-preview");var o=this._getContentProvider().parseMarkdown(n);if(!o||0===o.trim().length)return e.innerHTML="",void e.classList.remove("pict-mde-has-rich-preview");var a="PictMDE-RichPreviewBody-".concat(t);e.innerHTML='<div class="pict-content" id="'.concat(a,'">').concat(o,"</div>"),e.classList.add("pict-mde-has-rich-preview");var r=(this._richPreviewGenerations[t]||0)+1;this._richPreviewGenerations[t]=r;this._postRenderMermaid(a,t,r),this._postRenderKaTeX(a)}}}},{key:"_postRenderMermaid",value:function(t,e,i){if("undefined"!=typeof mermaid){var n=document.getElementById(t);if(n){var o=n.querySelectorAll("pre.mermaid");if(!(o.length<1)){var a=this;try{var r=mermaid.run({nodes:o});r&&"function"==typeof r.catch&&r.catch(function(t){a._richPreviewGenerations[e]===i&&a.log.warn("PICT-MarkdownEditor mermaid render error: ".concat(t.message||t))})}catch(t){this.log.warn("PICT-MarkdownEditor mermaid render error: ".concat(t.message||t))}}}}}},{key:"_postRenderKaTeX",value:function(t){if("undefined"!=typeof katex){var e=document.getElementById(t);if(e){for(var i=e.querySelectorAll(".pict-content-katex-inline"),n=0;n<i.length;n++)try{katex.render(i[n].textContent,i[n],{throwOnError:!1,displayMode:!1})}catch(t){this.log.warn("PICT-MarkdownEditor KaTeX inline error: ".concat(t.message||t))}for(var o=e.querySelectorAll(".pict-content-katex-display"),a=0;a<o.length;a++)try{katex.render(o[a].textContent,o[a],{throwOnError:!1,displayMode:!0})}catch(t){this.log.warn("PICT-MarkdownEditor KaTeX display error: ".concat(t.message||t))}}}}},{key:"_escapeHTMLForPreview",value:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},{key:"_updateSidebarPosition",value:function(t){var e=document.getElementById("PictMDE-Segment-".concat(t));if(e){var i=e.querySelector(".pict-mde-sidebar-actions");if(i){var n=this._segmentEditors[t];if(n){var o=n.state.selection.main.head,a=n.coordsAtPos(o);if(a){var r=e.getBoundingClientRect(),s=a.top-r.top,c=i.offsetHeight||0,l=e.offsetHeight||0,d=Math.max(0,l-c);s=Math.max(0,Math.min(s,d)),i.classList.add("pict-mde-sidebar-at-cursor"),i.style.setProperty("--pict-mde-sidebar-top","".concat(s,"px"))}else this._resetSidebarPosition(t)}}}}},{key:"_resetSidebarPosition",value:function(t){var e=document.getElementById("PictMDE-Segment-".concat(t));if(e){var i=e.querySelector(".pict-mde-sidebar-actions");i&&(i.classList.remove("pict-mde-sidebar-at-cursor"),i.style.removeProperty("--pict-mde-sidebar-top"))}}},{key:"toggleLineNumbers",value:function(t){this._lineNumbersVisible="boolean"==typeof t?t:!this._lineNumbersVisible;var e=this._getContainerElement();e&&(this._lineNumbersVisible?e.classList.add("pict-mde-linenums-on"):e.classList.remove("pict-mde-linenums-on"))}},{key:"togglePreview",value:function(t){this._previewsVisible="boolean"==typeof t?t:!this._previewsVisible;var e=this._getContainerElement();e&&(this._previewsVisible?e.classList.remove("pict-mde-previews-hidden"):e.classList.add("pict-mde-previews-hidden"))}},{key:"toggleSegmentPreview",value:function(t,e){var i=this._getLogicalIndex(t);if(!(i<0)){var n=!!this._hiddenPreviewSegments[i];(n="boolean"==typeof e?!e:!n)?this._hiddenPreviewSegments[i]=!0:delete this._hiddenPreviewSegments[i];var o=document.getElementById("PictMDE-Segment-".concat(t));o&&(n?o.classList.add("pict-mde-preview-hidden"):o.classList.remove("pict-mde-preview-hidden"))}}},{key:"_swapHiddenPreviewState",value:function(t,e){var i=!!this._hiddenPreviewSegments[t];!!this._hiddenPreviewSegments[e]?this._hiddenPreviewSegments[t]=!0:delete this._hiddenPreviewSegments[t],i?this._hiddenPreviewSegments[e]=!0:delete this._hiddenPreviewSegments[e]}},{key:"_reorderHiddenPreviewState",value:function(t,e){if(t!==e){var i=Object.keys(this._hiddenPreviewSegments).map(function(t){return parseInt(t,10)});if(0!==i.length){for(var n=Math.max.apply(Math,_toConsumableArray(i).concat([t,e])),o=[],a=0;a<=n;a++)o.push(!!this._hiddenPreviewSegments[a]);var r=o.splice(t,1)[0];o.splice(e,0,r),this._hiddenPreviewSegments={};for(var s=0;s<o.length;s++)o[s]&&(this._hiddenPreviewSegments[s]=!0)}}}},{key:"_getSegmentsFromData",value:function(){if(!this.options.ContentDataAddress)return null;var t={Fable:this.fable,Pict:this.fable,AppData:this.AppData,Bundle:this.Bundle,Options:this.options},e=this.fable.manifest.getValueByHash(t,this.options.ContentDataAddress);return Array.isArray(e)?e:null}},{key:"_setSegmentsToData",value:function(t){if(this.options.ContentDataAddress){var e={Fable:this.fable,Pict:this.fable,AppData:this.AppData,Bundle:this.Bundle,Options:this.options};this.fable.manifest.setValueByHash(e,this.options.ContentDataAddress,t)}}},{key:"_onSegmentContentChange",value:function(t,e){var i=this._getLogicalIndex(t);if(!(i<0)){var n=this._getSegmentsFromData();if(n){i<n.length&&(n[i].Content=e),this.onContentChange(i,e);var o=this;this._imagePreviewTimers[t]&&clearTimeout(this._imagePreviewTimers[t]),this._imagePreviewTimers[t]=setTimeout(function(){o._updateImagePreviews(t),delete o._imagePreviewTimers[t]},500),this._richPreviewTimers[t]&&clearTimeout(this._richPreviewTimers[t]),this._richPreviewTimers[t]=setTimeout(function(){o._updateRichPreviews(t),delete o._richPreviewTimers[t]},500)}}}},{key:"onContentChange",value:function(t,e){}},{key:"_getLogicalIndex",value:function(t){var e=this._getContainerElement();if(!e)return-1;for(var i=e.querySelectorAll(".pict-mde-segment"),n=0;n<i.length;n++){if(parseInt(i[n].getAttribute("data-segment-index"),10)===t)return n}return-1}},{key:"_getOrderedSegmentIndices",value:function(){var t=this._getContainerElement();if(!t)return[];for(var e=t.querySelectorAll(".pict-mde-segment"),i=[],n=0;n<e.length;n++)i.push(parseInt(e[n].getAttribute("data-segment-index"),10));return i}},{key:"addSegment",value:function(t){var e="string"==typeof t?t:"",i=this._getSegmentsFromData();i||(i=[]),i.push({Content:e}),this._setSegmentsToData(i),this._buildEditorUI()}},{key:"removeSegment",value:function(t){var e=this._getLogicalIndex(t);if(e<0)this.log.warn("PICT-MarkdownEditor removeSegment: segment index ".concat(t," not found."));else{var i=this._getSegmentsFromData();if(!i||i.length<=1)this.log.warn("PICT-MarkdownEditor removeSegment: cannot remove the last segment.");else{this._segmentEditors[t]&&(this._segmentEditors[t].destroy(),delete this._segmentEditors[t]),i.splice(e,1),this._setSegmentsToData(i);var n={};for(var o in this._hiddenPreviewSegments){var a=parseInt(o,10);a<e?n[a]=!0:a>e&&(n[a-1]=!0)}this._hiddenPreviewSegments=n,this._buildEditorUI()}}}},{key:"moveSegmentUp",value:function(t){var e=this._getLogicalIndex(t);if(!(e<=0)){this._marshalAllEditorsToData();var i=this._getSegmentsFromData();if(i){var n=i[e];i[e]=i[e-1],i[e-1]=n,this._swapHiddenPreviewState(e,e-1),this._buildEditorUI()}}}},{key:"moveSegmentDown",value:function(t){var e=this._getLogicalIndex(t),i=this._getSegmentsFromData();if(!(!i||e<0||e>=i.length-1)){this._marshalAllEditorsToData();var n=i[e];i[e]=i[e+1],i[e+1]=n,this._swapHiddenPreviewState(e,e+1),this._buildEditorUI()}}},{key:"getSegmentContent",value:function(t){var e=this._getOrderedSegmentIndices();if(t<0||t>=e.length)return"";var i=e[t],n=this._segmentEditors[i];return n?n.state.doc.toString():""}},{key:"setSegmentContent",value:function(t,e){var i=this._getOrderedSegmentIndices();if(t<0||t>=i.length)this.log.warn("PICT-MarkdownEditor setSegmentContent: index ".concat(t," out of range."));else{var n=i[t],o=this._segmentEditors[n];o&&o.dispatch({changes:{from:0,to:o.state.doc.length,insert:e}})}}},{key:"getSegmentCount",value:function(){return this._getOrderedSegmentIndices().length}},{key:"getAllContent",value:function(t){for(var e="string"==typeof t?t:"\n\n",i=this._getOrderedSegmentIndices(),n=[],o=0;o<i.length;o++){var a=this._segmentEditors[i[o]];a&&n.push(a.state.doc.toString())}return n.join(e)}},{key:"_marshalAllEditorsToData",value:function(){var t=this._getSegmentsFromData();if(t)for(var e=this._getOrderedSegmentIndices(),i=0;i<e.length;i++){var n=this._segmentEditors[e[i]];n&&i<t.length&&(t[i].Content=n.state.doc.toString())}}},{key:"setReadOnly",value:function(t){this.options.ReadOnly=t,this.initialRenderComplete&&(this._marshalAllEditorsToData(),this._buildEditorUI())}},{key:"marshalToView",value:function(){_superPropGet(e,"marshalToView",this,3)([]),this.initialRenderComplete&&this.options.ContentDataAddress&&this._buildEditorUI()}},{key:"marshalFromView",value:function(){_superPropGet(e,"marshalFromView",this,3)([]),this._marshalAllEditorsToData()}},{key:"destroy",value:function(){for(var t in this._segmentEditors)this._segmentEditors[t]&&this._segmentEditors[t].destroy();for(var e in this._segmentEditors={},this._richPreviewTimers)clearTimeout(this._richPreviewTimers[e]);this._richPreviewTimers={},this._richPreviewGenerations={}}}])}(n);e.exports=c,e.exports.default_configuration=r},{"./Pict-Section-MarkdownEditor-DefaultConfiguration.js":18,"pict-section-content":13,"pict-view":17}]},{},[1])(1)});
//# sourceMappingURL=markdown_editor_example.compatible.min.js.map
